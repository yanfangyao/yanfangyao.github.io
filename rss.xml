<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[William's Blog]]></title><description><![CDATA[严方耀的博客，William's blog]]></description><link>https://blog.yanfangyao.guru/</link><generator>RSS for Node</generator><lastBuildDate>Tue, 26 Mar 2019 13:56:18 GMT</lastBuildDate><item><title><![CDATA[如何安全可靠地检测浏览器存储是否可用？]]></title><description><![CDATA[遇到的坑 　　最近接触的H5项目需求中需要用到浏览器存储来记录用户足迹，笔者采用判断存储对象是否存在的方法来检验方法来校验浏览器存储是否可用，示例代码如下： 　　H5上线后，当其嵌入公司内部app…]]></description><link>https://blog.yanfangyao.guru//tips/20181014214613/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//tips/20181014214613/</guid><pubDate>Sun, 14 Oct 2018 21:46:13 GMT</pubDate><content:encoded>&lt;h2&gt;遇到的坑&lt;/h2&gt;
&lt;p&gt;　　最近接触的H5项目需求中需要用到浏览器存储来记录用户足迹，笔者采用判断存储对象是否存在的方法来检验方法来校验浏览器存储是否可用，示例代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;localStorage&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 这样就认为浏览器存储可用&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　H5上线后，当其嵌入公司内部app时，页面报错。经过分析和排查，错误的原因在于校验浏览器存储可用性的方法不合理。公司内部app使用的webview版本很老，会禁止浏览器存储的使用，就连访问window对象的localStorage属性也会报错。&lt;br&gt;
　　考虑到目前用户手机上存在各种不同特性的浏览器和webview，如何才能安全可靠地检测不同浏览器环境下浏览器存储是否可用？&lt;/p&gt;
&lt;h2&gt;问题解决方案&lt;/h2&gt;
&lt;p&gt;　　浏览器&lt;strong&gt;支持存储功能&lt;/strong&gt;与&lt;strong&gt;存储功能可用&lt;/strong&gt;不是一个概念，比如Safari在隐身模式下会将浏览器localStorage存储容量设置为0，意味着浏览器的存储功能实际不可用，但是Safari是支持浏览器存储功能的。部分浏览器甚至可以让用户设置禁止浏览器存储。因此，笔者在项目中想通过检测window全局对象上是否有localStorage属性来判断当前浏览器localStorage是否可用的方法是非常片面的，只能适用于部分场景。笔者查阅资料后得知，&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API#Feature-detecting_localStorage&quot;&gt;MDN官方文档&lt;/a&gt;介绍了一个可以安全可靠地检测浏览器存储可用性的函数，其源码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight has-highlighted-lines&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;storageAvailable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; storage &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; window&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;__storage_test__&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        storage&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setItem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        storage&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;removeItem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; e &lt;span class=&quot;token keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DOMException&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 当异常是由浏览器存储容量不够造成时，需要排除浏览器存储容量限额为0的特殊情况&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 非Firefox浏览器存储内容大小超出存储容量时所报出异常的code&lt;/span&gt;
&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;            e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;code &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt;&lt;/span&gt;            &lt;span class=&quot;token comment&quot;&gt;// Firefox浏览器存储内容大小超出存储容量时所报出异常的code&lt;/span&gt;
&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;            e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;code &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1014&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt;&lt;/span&gt;            &lt;span class=&quot;token comment&quot;&gt;// 除了检测异常的code属性外，还需要检测异常的name属性，防止部分情况下异常没有code属性&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 非Firefox浏览器&lt;/span&gt;
&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;            e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;QuotaExceededError&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt;&lt;/span&gt;            &lt;span class=&quot;token comment&quot;&gt;// Firefox浏览器&lt;/span&gt;
&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;            e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;NS_ERROR_DOM_QUOTA_REACHED&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;/span&gt;            &lt;span class=&quot;token comment&quot;&gt;// 排除存储容量不为0的情况&lt;/span&gt;
&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;            storage&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/span&gt;    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　源码中的高亮部分为不同浏览器环境下判断异常是否是由浏览器存储容量溢出而造成的。需要注意的一点是，存储容量溢出并且存储容量的大小不为0代表浏览器存储是可用的，此时只需要删除部分存储内容即可。&lt;br&gt;
　　该可用性检测函数对于localStorage和sessionStorage均适用，在使用浏览器存储前，利用上述函数检测浏览器存储是否可用是安全可靠的。&lt;/p&gt;
&lt;h2&gt;参考文献&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API#Feature-detecting_localStorage&quot;&gt;MDN文档：Using the Web Storage API&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[如何理解React的虚拟DOM？]]></title><description><![CDATA[真实的DOM 　　在web应用中，浏览器接收到服务器返回的html文档后，会将html文档解析成DOM树，具体流程可以参考 这篇博文 。DOM树是浏览器在 内存中对html文档的抽象化表示 ，方便开发者使用javascript操作html…]]></description><link>https://blog.yanfangyao.guru//notes/20181010191446/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//notes/20181010191446/</guid><pubDate>Wed, 10 Oct 2018 19:14:46 GMT</pubDate><content:encoded>&lt;h2&gt;真实的DOM&lt;/h2&gt;
&lt;p&gt;　　在web应用中，浏览器接收到服务器返回的html文档后，会将html文档解析成DOM树，具体流程可以参考&lt;a href=&quot;/notes/20180424213011/&quot;&gt;这篇博文&lt;/a&gt;。DOM树是浏览器在&lt;strong&gt;内存中对html文档的抽象化表示&lt;/strong&gt;，方便开发者使用javascript操作html文档。在传统的前端开发模式下，页面的更新方式大致如图1所示。&lt;/p&gt;
&lt;center&gt;
&lt;p&gt;&lt;img src=&quot;/static/tranditional_interaction-ccd2e0c6295d704f69925241c48224ef.svg&quot; alt=&quot;传统页面更新方式&quot;&gt;&lt;/p&gt;
&lt;/center&gt;
&lt;center&gt;图 1 传统的页面更新方式&lt;/center&gt;
&lt;p&gt;　　传统的web页面更新方式是利用javascript直接操作DOM树，这种做法对于结构简单的页面来说无可厚非，但是对于具有复杂交互功能的页面而言，其效率非常低下。实际上，对于一个大型网站而言，使用javascript对DOM树进行增、删、查、改等操作造成的开销很大，并且无法有效地减少无意义的DOM操作（比如使用javascript动态生成一个列表，就算新列表和旧列表之间只有一列不相同，但是新列表仍然会整个替换旧列表）。除了效率低下之外，传统的前端开发模式编写的代码非常不利于维护，代码中充斥着各种写死的类名和id名以及各种事件绑定函数。&lt;/p&gt;
&lt;h2&gt;虚拟DOM&lt;/h2&gt;
&lt;p&gt;　　因为频繁地操作真实DOM开销巨大，为了减少无意义的DOM操作，提高页面性能，React在浏览器DOM的基础上进行进一步抽象，实现了一套独立于浏览器的虚拟DOM。所谓虚拟DOM，即一个用来描述真实DOM的javascript对象。React使用ReactElement来对真实的DOM进行抽象，对于每一个真实的DOM元素，如div、span等，React均可以创建一个对应的ReactElement对象。React 16中创建ReactElement对象的createElement方法的源码及笔者标出的注释如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 保留的属性，用户不能修改&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;RESERVED_PROPS&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  ref&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  __self&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  __source&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;/**
 * 创建ReactElement对象的工厂函数
 * @param {*} type 元素类型
 * @param {*} key 元素的key，React的虚拟DOM diff算法会用到
 * @param {string|object} ref ReactElemet生成的实际DOM的引用
 * @param {*} self 临时变量，用于检测调用React.createElement时&apos;this&apos;与&apos;owner&apos;不同的地方，以便发出警告
 * @param {*} source 一个注释对象，指明文件名、行号或者其他信息
 * @param {*} owner 创建该元素的组件
 * @param {*} props 元素属性
 * @internal
 */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;ReactElement&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ref&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; source&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; owner&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; element &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// $$typeof属性可以用来判断元素类型，REACT_ELEMENT_TYPE是一个常量，表示当前对象为ReactElement类型&lt;/span&gt;
        $$&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;REACT_ELEMENT_TYPE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 类型&lt;/span&gt;
        type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 标志&lt;/span&gt;
        key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 生成的真实DOM的引用&lt;/span&gt;
        ref&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ref&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 属性&lt;/span&gt;
        props&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; props&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 创建改元素的组件&lt;/span&gt;
        _owner&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; owner&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// 开发环境下的操作&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;__DEV__&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        element&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_store &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;defineProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;element&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_store&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;validated&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            configurable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            enumerable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            writable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// self属性和source属性只在开发环境下有用&lt;/span&gt;
        Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;defineProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;element&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;_self&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            configurable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            enumerable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            writable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;defineProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;element&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;_source&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            configurable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            enumerable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            writable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; source&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 冻结对象&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;freeze&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;freeze&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;element&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;freeze&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;element&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; element&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;/**
 * @param {*} type 元素类型，取值可以是DOM元素名，如&apos;div&apos;, &apos;span&apos;等；可以取值为ReactComponent类型或 者ReactFragment类型
 * @param {*} config 元素属性
 * @param {*} children 元素子元素，取值可以为多个
 */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; children&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; propName&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Reserved names are extracted&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; props &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ref &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; self &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; source &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 判断输入的ref属性和key属性是否合法&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasValidRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          ref &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ref&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasValidKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        
        &lt;span class=&quot;token comment&quot;&gt;// 设置self属性和source属性&lt;/span&gt;
        self &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;__self &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; undefined &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;__self&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        source &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;__source &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; undefined &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;__source&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;token comment&quot;&gt;// 将config中非保留属性复制到props中&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;propName &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            hasOwnProperty&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; propName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;RESERVED_PROPS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasOwnProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;propName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            props&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;propName&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;propName&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;// 可以以多个参数的方式将子元素传入&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; childrenLength &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; arguments&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;childrenLength &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 只有一个子元素时，直接赋值给props对象的children属性&lt;/span&gt;
        props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;children &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; children&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;childrenLength &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; childArray &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;childrenLength&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; childrenLength&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            childArray&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; arguments&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 在开发环境下冻结childArray&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;__DEV__&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;freeze&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;freeze&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;childArray&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 拥有多个子元素时，转换成数组赋值给children属性&lt;/span&gt;
        props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;children &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; childArray&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;// 解析默认属性&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;type &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;defaultProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; defaultProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;defaultProps&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;propName &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; defaultProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;propName&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; undefined&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                props&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;propName&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; defaultProps&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;propName&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;// 在开发环境下对key和ref进行处理&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;__DEV__&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; ref&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; displayName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; type &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt;
                    &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;displayName &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Unknown&apos;&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;// 试图直接访问key属性时出现警告&lt;/span&gt;
                &lt;span class=&quot;token function&quot;&gt;defineKeyPropWarningGetter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; displayName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ref&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;// 试图直接访问ref属性时出现警告&lt;/span&gt;
                &lt;span class=&quot;token function&quot;&gt;defineRefPropWarningGetter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; displayName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;// 返回生成的ReactElement对象&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ReactElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        type&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        ref&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        self&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        source&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        ReactCurrentOwner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        props&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　在React中，所有对真实DOM的操作都转换为对虚拟DOM的操作。使用React开发时页面的更新方式可以用图2描述：&lt;/p&gt;
&lt;center&gt;
&lt;p&gt;&lt;img src=&quot;/static/react_interaction-d1867788d14a591cc8b41c3a17413b86.svg&quot; alt=&quot;使用React框架后页面更新方式&quot;&gt;&lt;/p&gt;
&lt;/center&gt;
&lt;center&gt;图 2 使用React框架后页面更新方式&lt;/center&gt;
&lt;p&gt;　　在更新DOM时，React不会直接操作所有ReactElement对象对应的真实DOM，而是首先对比当前新生成的ReactElement对象和旧ReactElement对象之间的差异，然后只操作发生了变化的ReactElement对象对应的真实DOM来更新页面。React减少了无意义的DOM操作，提高了页面性能。&lt;br&gt;
　　在React中，ReactElement对象是不可变的，一旦被创建之后，其属性不能被更改，当需要更新页面时，必须重新创建和渲染ReactElement对象。为了更好地组织页面，React引入了ReactComponent的概念。ReactComponent是有状态的组件，当组件状态发生变化时，组件会自动创建新的ReactElement对象。&lt;br&gt;
　　本文重点在于介绍React的虚拟DOM，在后续文章中，笔者会对ReactComponent进行详细的分析。&lt;/p&gt;
&lt;h2&gt;参考文献&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://www.codecademy.com/articles/react-virtual-dom&quot;&gt;React: The Virtual DOM&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://reactkungfu.com/2015/10/the-difference-between-virtual-dom-and-dom/&quot;&gt;The difference between Virtual DOM and DOM&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://reactjs.org/docs/dom-elements.html&quot;&gt;reactjs: dom-elements&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://reactjs.org/docs/rendering-elements.html&quot;&gt;reactjs: rendering-elements&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://segmentfault.com/a/1190000010924023&quot;&gt;segmentfault: 图解 React Virtual DOM&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[ECMAScript 5的严格模式]]></title><description><![CDATA[前言 　　ECMAScript 5引入了严格模式（strict mode）的概念，对向来以宽语法规则出名的javascript语言进行了一系列约束。javascript…]]></description><link>https://blog.yanfangyao.guru//notes/20180920212719/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//notes/20180920212719/</guid><pubDate>Thu, 20 Sep 2018 21:27:19 GMT</pubDate><content:encoded>&lt;h2&gt;前言&lt;/h2&gt;
&lt;p&gt;　　ECMAScript 5引入了严格模式（strict mode）的概念，对向来以宽语法规则出名的javascript语言进行了一系列约束。javascript的严格模式并不是必须的，可以根据需要选择性的将代码放在严格模式下执行。&lt;/p&gt;
&lt;h2&gt;如何启用严格模式&lt;/h2&gt;
&lt;p&gt;　　ECMAScript 5的严格模式有其作用范围：&lt;strong&gt;整个脚本&lt;/strong&gt;或者&lt;strong&gt;函数作用域&lt;/strong&gt;。严格模式在块级作用域中不起作用。启用严格模式的方法是在javascript脚本或者函数作用域开头插入语句”use strict”;或者’use strict’;。&lt;br&gt;
　　ECMAScipt 6中引入了模块的概念，对于一个javascript模块而言，其默认使用严格模式解析。&lt;/p&gt;
&lt;h2&gt;严格模式带来的好处&lt;/h2&gt;
&lt;h3&gt;对错误语法报出运行时错误&lt;/h3&gt;
&lt;p&gt;　　因为javascript语法的宽容性，在非严格模式下运行脚本时，解析器会自动忽略一些错误的语法。在严格模式下，对于语法错误，javascript解析器会抛出运行时错误，提醒开发者脚本出错。相关的错误语法可以归结为如下几类：&lt;br&gt;
　　（1）隐式创建全局对象属性。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 在非严格模式下，以下代码可以正常运行，会给当前全局对象创建一个名为invalidVar的属性。&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 在严格模式下，执行以下代码时，解析器会报出Reference Error错误。&lt;/span&gt;
invalidVar &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　（2）不合法的赋值操作。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 以下示例代码在非严格模式下运行时均不会报错，解析器会直接忽略这些操作&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 但是在严格模式运行以下代码时，解析器会报错&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 给内置的具有只读属性的全局变量属性赋值&lt;/span&gt;
undefined &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 在严格模式下会报出TypeError&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 给一个普通对象的只读属性复制&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; obj1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;defineProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;obj1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;prop&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    writable&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 在严格模式下会报出TypeError错误&lt;/span&gt;
obj1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prop &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 给一个对象已经设置了getter的属性赋值&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; obj2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 在严格模式下会报出TypeError错误&lt;/span&gt;
obj2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 给一个设置了不能扩展的对象增加新属性&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; nonExensible &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;preventExtensions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nonExensible&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 在严格模式下会报出TypeError错误&lt;/span&gt;
nonExensible&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　（3）删除不能删除的属性。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 下面的代码在严格模式下执行会报出TypeError错误&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;delete&lt;/span&gt; Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prototype&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　（4）函数参数名重复。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 在非严格模式下，解析器不会报错，对于重名的参数而言，实际使用参数时，解析器会取参数列表中位置最靠后的已赋值的同名参数值。&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 在严格模式下，解析器会报出SyntaxError&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　（5）使用八进制数表示方法。&lt;br&gt;
　　现代浏览器都支持在数字前面添加前缀数字0表示八进制数，但是在严格模式下，这种八进制表示方法是错误的。ECMAScript 5并没有规定八进制数字的表示方式。ECMAScript 6使用’0o’（数字0和字母o）作为八进制数字的前缀。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 在严格模式下，下面的代码会报出SyntaxError错误&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;012&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　（6）给原始类型值添加属性。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 以下代码在严格模式下运行会报出TypeError错误&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prop &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;有利于编译器更好地优化代码&lt;/h3&gt;
&lt;p&gt;　　严格模式通过简化变量的使用方式，禁止了变量的一些复杂用法，可以让编译器在运行前做一些关于变量的优化工作。&lt;br&gt;
　　（1）禁止with语法。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 严格模式禁止使用with语法，以下代码运行在严格模式下会抛出SyntaxError错误&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　（2）eval语句不再引入新变量到当前执行上下文中。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 在非严格模式下，执行下面的语句会在当前上下文中引入新的变量a&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 在严格模式下，执行下面的语句并不会在当前上下文中引入新变量&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;eval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;var a = 1;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　（3）delete删除原始类型变量会报错。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; primitive &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 严格模式下会报出SyntaxError&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;delete&lt;/span&gt; primitive&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　（4）arguments中的元素不再和函数参数进行绑定，只保存传入参数的初始值。参数值的改变和arguments中元素值的改变互不干扰。&lt;br&gt;
　　（5）禁止arguments.callee。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 严格模式下运行下面代码报出TypeError错误&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  arguments&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;callee&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;编写更安全的代码&lt;/h3&gt;
&lt;p&gt;　　（1）函数中的this取值不再限制于只能是对象。&lt;br&gt;
　　在非严格模式下，当给this赋值为原始类型时，解析器自动将原始类型进行封装，转换成对应的对象类型，如给this赋值1时，解析器会执行Number(1)对数字进行封装；当给this赋值为undefined、null或者不赋值时，解析器会将this赋值成当前所处环境的全局对象。然而，在严格模式下，编译器不会对this的值进行自动封装，当不设置this的值时，this的值为undefined。&lt;br&gt;
　　（2）禁止使用函数的caller属性、arguments属性。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 严格模式下报出TypeError错误&lt;/span&gt;
    func&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;caller&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 严格模式下报出TypeError错误&lt;/span&gt;
    func&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;arguments&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;操作保留关键字会报错&lt;/h3&gt;
&lt;p&gt;　　在严格模式下使用保留的关键字会报出SyntaxError错误，保留的关键字有&lt;strong&gt;implements, interface, let, package, private, protected, public, static, yield&lt;/strong&gt;。&lt;/p&gt;
&lt;h2&gt;总结&lt;/h2&gt;
&lt;p&gt;　　严格模式的使用会促使前端开发者编写出更加安全可靠的代码。在使用ECMAScript 5语法进行业务开发时，笔者建议使用javascript的严格模式。对于ECMAScript 6语法而言，babel编译工具将其编译为ECMAScript 5语法时自动开启严格模式，开发者也可以配置babel不使用严格模式。&lt;/p&gt;
&lt;h2&gt;参考文献&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode&quot;&gt;MDN: Strict mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode/Transitioning_to_strict_mode&quot;&gt;MDN: Transitioning to strict mode&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[MVC、MVP、MVVM软件架构学习笔记]]></title><description><![CDATA[前言 　　MVC、MVP和MVVM是开发GUI（图形用户界面）应用程序时常用的软件架构模式。它们的目的是通过一些手段将GUI应用程序的用户界面（View）和数据（Model…]]></description><link>https://blog.yanfangyao.guru//notes/20180824143040/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//notes/20180824143040/</guid><pubDate>Fri, 24 Aug 2018 14:30:40 GMT</pubDate><content:encoded>&lt;h2&gt;前言&lt;/h2&gt;
&lt;p&gt;　　MVC、MVP和MVVM是开发GUI（图形用户界面）应用程序时常用的软件架构模式。它们的目的是通过一些手段将GUI应用程序的用户界面（View）和数据（Model）进行分离，提高代码的可复用性和可维护性。本文对三种架构模式的思想进行了深入研究并对比分析了它们的优缺点。&lt;/p&gt;
&lt;h2&gt;MVC&lt;/h2&gt;
&lt;p&gt;　　MVC模式将GUI应用程序分成三个模块：&lt;strong&gt;Model&lt;/strong&gt;、&lt;strong&gt;View&lt;/strong&gt;和&lt;strong&gt;Controller&lt;/strong&gt;。这三个模块相互之间的交互如图1所示。&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f03b3d6ce1bcbe2d105f5fbf2c673a1c/438a5/MVC.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 460px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 51.95652173913044%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABcSAAAXEgFnn9JSAAACUklEQVQoz3VSbUhTYRR+7t2HbrXAooTc0sY0xUGQ6cqM9TNCV35Mg9kcfaqkleWPyqAPRIjAJg7qZ/VjIO7eq+a0q9NNzY0+KHFF/aqQ8E8Q/TMiTu9du1KRLxze933OOc97zvMeTANQTFmLAJc+4l2MOAiN4+b4aTq7GKDzyftknj9FEHxPrTIZ1LhlZqYIIcT2GQWI/UO2BGQ1elo3IULbILg7DcN1yQL5TKJwoiXOzm8guru4EbIag/F1BGQoOZ/SHFPqKy/SZM8By6RG67P658tApMUay3YnpsMrKhjLNLqfAXYFS6jd5fUd0LBk7oEFhggP7+7rQSe761PO6Sj3uaoC1P6Qo8th7vu5BuBx+HfiN8rI7Y86ZB3fEs5EjgLtuVqm+evlwn7KZWRpDZY5+k91KSzxcVVrV2eyiGG61QBOqi1FyFmOgUsNELuO6kL7HRhqMql+pnF+FHAyK58FNqq4NnzciGCpA9KFagx3uPBoZwUGD5UAoutH1piHSqbbafOo5yee1BAnXfFpBikb8lebo2tgV2VL776DbYG91rtzxRj9YssUKQehm03myAmyTzTTjslmcsxcpPUjDSuAXEuGKQ8de9tLBXNthNk64qUbHZAomxc+FCFKVrykPCRoO8IrNohLhdoh2grx2knTnJeqF3qo9f09qlzoJo1cz7qXjnSzKvsZu18j1fghHg5wkidfbU3W6osjPO9j1jiuN1j+kMoCoarPOFzftyXs9euH6gIQKm+tNRmw9xiRHgc9G9gNTD/TayD1i0W310zDL3iT3um6cDwiAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;MVC交互示意图&quot;
        title=&quot;&quot;
        src=&quot;/static/f03b3d6ce1bcbe2d105f5fbf2c673a1c/438a5/MVC.png&quot;
        srcset=&quot;/static/f03b3d6ce1bcbe2d105f5fbf2c673a1c/d6ca3/MVC.png 148w,
/static/f03b3d6ce1bcbe2d105f5fbf2c673a1c/8ec60/MVC.png 295w,
/static/f03b3d6ce1bcbe2d105f5fbf2c673a1c/438a5/MVC.png 460w&quot;
        sizes=&quot;(max-width: 460px) 100vw, 460px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 1 MVC软件架构模式模块之间交互示意图&lt;/div&gt;
&lt;p&gt;　　对上述三个模块相互之间的交互描述如下: Model可以直接访问数据，其与View和Controller是独立的。Model自身并不关心其是如何被View显示和被Controller操作的，但是Model中数据发生变化后会以一种机制通知View，让View进行更新。为了实现这种机制，可以让相关View在Model上进行注册（或者订阅），当Model数据发生变动时，Model调用View提供的接口可以让对应的View知晓数据的变动。Controller的作用是组织Model和View，控制应用程序的流程。Controller接受来自View反馈的用户行为，然后根据用户行为操作Model引起数据的改变，进而触发View的更新。Controller也可以根据用户行为直接更新View。&lt;br&gt;
　　以使用MVC模式开发一个传统的Web页面应用为例，Model、View和Controller的定义如下：&lt;br&gt;
　　Model: 用于封装与Web页面应用的业务逻辑相关的数据以及对数据的处理方法。&lt;br&gt;
　　View: 浏览器展示给用户的Web页面。&lt;br&gt;
　　Controller: 转发请求或者对请求进行处理。&lt;br&gt;
　　以JavaScript语言为例，使用MVC模式开发一个加减计数器实例如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/**
 * 使用MVC架构模式实现一个加减计数器
 * Model实现了对计数器count的封装
 * View将count值展示到页面
 * Controller处理用户动作
 */&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Model&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;subscribers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;// 每次加1&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;addCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;// 每次减1&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;subCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;// 读取count值&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;getCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;// 设置count值&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;setCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;// 订阅数据变更&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;view&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;subscribers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;view&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;// 发布通知&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;publish&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;subscribers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;controller&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elText &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;#elText&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elAdd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;#elAdd&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elSub &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;#elSub&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;controller &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; controller&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;token comment&quot;&gt;// 绑定事件&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elAdd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;click&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;controller&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;handleAdd&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elSub&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;click&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;controller&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;handleSub&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;model&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elText&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;innerHTML &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; model&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Controller&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;view &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;View&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
       &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;model &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Model&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
       &lt;span class=&quot;token comment&quot;&gt;// 订阅model数据变更&lt;/span&gt;
       &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;model&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;view&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token function&quot;&gt;handleAdd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;model&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 发布变更通知&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;model&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;publish&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token function&quot;&gt;handleSub&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;model&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 发布变更通知&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;model&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;publish&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 启动应用&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Controller&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　MVC架构的应用使得复杂的GUI应用程序变得模块化，提高了应用程序的可复用性和可扩展性。MVC架构的应用也使得GUI应用的开发人员变得分工明确，开发人员可以根据自己的专长来从事Model、View或者Controller层面的开发，各个开发人员之间协商好接口之后便可以开始并行开发，从而提高了程序开发效率。虽然MVC架构模式具有上述优点，但是由于其View层和Controller层关联过于紧密，View和Controller一般一一对应，通常将两者打包成一个组件，并且在MVC模式中View层直接可以访问Model，这样可能会造成数据安全性问题。为了让Controller单独可复用以及View和Model进一步隔离，人们对MVC架构模式进行了改进，设计出了MVP这一软件架构模式。&lt;/p&gt;
&lt;h2&gt;MVP&lt;/h2&gt;
&lt;p&gt;　　MVP模式使用&lt;strong&gt;Presenter&lt;/strong&gt;替换了MVC模式中的Controller，MVP架构模式中各个模块的交互如图2所示。&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/73e4c607f95fc7996f85c2027fc39942/ad191/MVP.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 16.382978723404253%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABcSAAAXEgFnn9JSAAAA/klEQVQI1wHzAAz/AACwUHwLs1eDDLNYhQCzUXhEcEgXuAcPPLUKETRKXU8VC7dccQ6zWYYQtFqECLdadz9qPxu6BQxJugQLRTJ/XBgAslJ5D7RZhQy0WIIAr0+BAADGVv842YH/OdyD/wDBVv8CsK5TALP/LQC1/y8ArMFHD79i/0bgjP9T45T/Echo/wCspVoAtv8sB63/LwCsqlMIxl//Xeab/1Xilf8AyFr/AACuTZEPtFqYErVcmQCwTo0zhl0ZvQIIRbgGC0JsWUMUAK9Kgxm3YJsfuWSZALBNjDx9Ux+9AQdMvQILPimEShYBslKNJbppmSS7aJcAr0+WhTNjd2h/7C4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;MVP架构模式模块之间交互示意图&quot;
        title=&quot;&quot;
        src=&quot;/static/73e4c607f95fc7996f85c2027fc39942/40fad/MVP.png&quot;
        srcset=&quot;/static/73e4c607f95fc7996f85c2027fc39942/707e9/MVP.png 148w,
/static/73e4c607f95fc7996f85c2027fc39942/649e0/MVP.png 295w,
/static/73e4c607f95fc7996f85c2027fc39942/40fad/MVP.png 590w,
/static/73e4c607f95fc7996f85c2027fc39942/b3fef/MVP.png 885w,
/static/73e4c607f95fc7996f85c2027fc39942/301c0/MVP.png 1180w,
/static/73e4c607f95fc7996f85c2027fc39942/ad191/MVP.png 1410w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 2 MVP软件架构模式模块之间交互示意图&lt;/div&gt;
&lt;p&gt;　　在MVP架构模式中Model和View之间完全独立，Presenter作为中间协调器将两者联系起来。在MVP模式中，Model不知晓View的存在，View也不知晓Model的存在，数据的更新以及页面的刷新全部由Presenter来控制。&lt;br&gt;
　　使用MVP架构模式对上述采用MVC架构的加减计数器代码进行重构，重构后的代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/**
 * 使用MVP架构模式重构加减计数器
 * Model实现了对计数器count的封装
 * View将count值展示到页面
 * Presenter负责数据的更新与View的刷新
 */&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Model&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;// 每次加1&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;addCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;// 每次减1&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;subCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;// 读取count值&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;getCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;// 设置count值&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;setCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elText &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;#elText&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elAdd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;#elAdd&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elSub &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;#elSub&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;presenter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Presenter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 绑定事件&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elAdd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;click&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;presenter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;handleAdd&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elSub&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;click&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;presenter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;handleSub&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;elText&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;innerHTML &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Presenter&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;view&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;view &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; view&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;model &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Model&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
   
    &lt;span class=&quot;token function&quot;&gt;handleAdd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 更新数据&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;model&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 更新页面&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;view&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;model&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token function&quot;&gt;handleSub&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 更新数据&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;model&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 更新页面&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;view&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;model&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 启动应用&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;View&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　MVP模式与MVC模式相比，其优点在于Model层和View层完全独立，Presenter作为中间层保持View和Model之间的同步。在MVC和MVP模式中均存在一个问题: Controller和Presenter都需要直接或者间接地调用View提供的接口来对页面进行刷新。对于开发者来说，直接调用View接口来更新页面不仅增加了代码量，而且在某些场景下会频繁地操作DOM。如何解决这些问题？在MVP架构模式的基础上，人们引入数据绑定的概念，设计出了目前流行的MVVM软件架构模式。&lt;/p&gt;
&lt;h2&gt;MVVM&lt;/h2&gt;
&lt;p&gt;　　MVVM模式使用&lt;strong&gt;ViewModel&lt;/strong&gt;替换了MVP模式中的Presenter，该模式下模块之间的交互如图3所示。&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/584efeed021db45dbba1c4480fa8e132/ad191/MVVM.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 16.382978723404253%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABcSAAAXEgFnn9JSAAAA+0lEQVQI12NgWOtVw7EptBmIWxk2+FU6VUjy3mBg0L3GwKDRbsvAwbApsJBhnW8bwzq/FobNgeVeuW7SO1l5PHexcLsa1cdIMGwKquTfEtnKsyWiiWG9fyOD0Ln0/053Ov57POz9z3I49j/r0k7HJqt420rnVBuWmdNNpA9m/je4Vfvf4EbNf6WzJf8Z1q2MYtj6X4d97X99hjWrgjmOxf+PfTb7f+ijqf8ZTkT9ZxDZFjdRdmfKDMVdaTM5N4X1MWysFWGAge0LeNk3hrbxbomcxbs5Yib71sges2o/+X2M7D57mbjtNFu8xBg3BfWq7sqcqbI7YzrQhdMAwHRfxrvnJFgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;MVVM交互示意图&quot;
        title=&quot;&quot;
        src=&quot;/static/584efeed021db45dbba1c4480fa8e132/40fad/MVVM.png&quot;
        srcset=&quot;/static/584efeed021db45dbba1c4480fa8e132/707e9/MVVM.png 148w,
/static/584efeed021db45dbba1c4480fa8e132/649e0/MVVM.png 295w,
/static/584efeed021db45dbba1c4480fa8e132/40fad/MVVM.png 590w,
/static/584efeed021db45dbba1c4480fa8e132/b3fef/MVVM.png 885w,
/static/584efeed021db45dbba1c4480fa8e132/301c0/MVVM.png 1180w,
/static/584efeed021db45dbba1c4480fa8e132/ad191/MVVM.png 1410w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 3 MVVM软件架构模式模块之间交互示意图&lt;/div&gt;
&lt;p&gt;　　与Presenter调用View提供的接口进行页面刷新不同，ViewModel通过数据绑定的方式将View和ViewModel进行绑定，当用户操作页面时，ViewModel自动获取到页面的变动，并自动更新Model；当Model数据发生变动时，ViewModel获取到数据变动后自动更新View。数据绑定功能实现了View和Model的自动同步，开发人员尤其是前端工程师在开发GUI应用程序时不用再关心页面如何渲染以及页面渲染是否高效的问题，开发人员重点关注如何处理前端业务逻辑。&lt;br&gt;
　　使用JavaScript语言的MVVM框架Vue.js对上述加减计数器进行重构，重构后的代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/**
 * 使用Vue.js重构加减计数器
 * Model是一个对象，保存了业务数据，在本例中就是count值
 * View可以看做是Vue模板，通过Vue提供的相应的模板语法和ViewModel进行数据和事件的绑定
 * ViewModel是一个Vue对象，数据绑定功能由Vue框架内部实现，开发者无需关心，只需关心业务逻辑即可
 */&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; model &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;// View
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;h1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;{{count}}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;h1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;button&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;@click&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;handleAdd&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;+&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;button&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;button&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;@click&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;handleSub&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;-&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;button&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ViewModel&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; viewModel &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    el&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;#app&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    data&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; model&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    methods&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;handleAdd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;handleSub&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　MVVM架构模式进一步提高了GUI应用程序的研发效率。为了实现数据绑定，部分MVVM框架可能会创建出很多观察器来对数据进行观察，对于数据结构复杂的GUI应用而言，数据绑定可能会占用大量的内存空间。&lt;/p&gt;
&lt;h2&gt;总结&lt;/h2&gt;
&lt;p&gt;　　MVC、MVP以及MVVM等MV*架构模式都是为了分离GUI应用程序的Model（数据）和View（界面）以提高研发效率和增强GUI应用程序可维护性而提出来的软件架构模式。它们之间的差异在于各个模块之间的耦合程度以及程序研发的关注点。了解不同架构模式的优缺点可以帮助我们在应对不同的业务需求时选择合适的软件架构模式，依靠某一种架构模式应对所有的业务场景是不合适的。&lt;/p&gt;
&lt;h2&gt;参考文献&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://martinfowler.com/eaaDev/uiArchs.html&quot;&gt;GUI Architectures&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/MVC&quot;&gt;Wikipedia: MVC&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93presenter&quot;&gt;Wikipedia: Model–view–presenter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/MVVM&quot;&gt;Wikipedia: MVVM&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blogs.msdn.microsoft.com/johngossman/2006/03/04/advantages-and-disadvantages-of-m-v-vm/&quot;&gt;MSDN: Advantages and disadvantages of M-V-VM&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://addyosmani.com/blog/understanding-mvvm-a-guide-for-javascript-developers/&quot;&gt;Understanding MVVM - A Guide For JavaScript Developers&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://juejin.im/post/593021272f301e0058273468&quot;&gt;掘金: 浅析前端开发中的 MVC/MVP/MVVM 模式&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[sourcemap学习笔记]]></title><description><![CDATA[sourcemap产生的背景 　　前端代码开发已经实现了模块化和工程化。为了减小静态资源体积，一般会选择将对js和css文件进行压缩形成一个或者多个bundle…]]></description><link>https://blog.yanfangyao.guru//notes/20180718144710/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//notes/20180718144710/</guid><pubDate>Wed, 18 Jul 2018 14:47:10 GMT</pubDate><content:encoded>&lt;h2&gt;sourcemap产生的背景&lt;/h2&gt;
&lt;p&gt;　　前端代码开发已经实现了模块化和工程化。为了减小静态资源体积，一般会选择将对js和css文件进行压缩形成一个或者多个bundle文件。压缩后的代码几乎不具有可毒性。这样会存在一个问题：当压缩后代码出现错误时，我们如何快速地定位到源码中出错的位置？sourcemap文件就是为了解决这种问题而被设计出来的。sourcemap在编译压缩后的bundle与源代码之间建立了一个映射关系，通过sourcemap可以很快地找到bundle中某一行代码在源代码中对应的位置。&lt;/p&gt;
&lt;h2&gt;sourcemap格式&lt;/h2&gt;
&lt;p&gt;　　sourcemap文件包含一个JSON对象，典型的数据结构如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;version&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;bundle.js&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;sourceRoot&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;sources&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;foo.js&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;bar.js&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;sourcesContent&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token null&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token null&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;names&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;src&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;maps&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;are&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;fun&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;mappings&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;A,AAAB;;ABCDE;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　对上述JSON对象的属性介绍如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;version&lt;/strong&gt;: sourcemap文件的版本号，取值为正整数。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;file&lt;/strong&gt;: sourcemap文件对应的bundle文件参数。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;sourceRoot&lt;/strong&gt;: sourcemap文件对应的源代码所在根目录。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;sources&lt;/strong&gt;: 源文件列表。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;sourcesContent&lt;/strong&gt;: 源文件内容列表，顺序与sources元素顺序对应。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;names&lt;/strong&gt;: 源代码中所有变量名和属性名列表。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;mappings&lt;/strong&gt;: 存储映射关系（&lt;a href=&quot;/notes/20180314211238/&quot;&gt;Base 64编码&lt;/a&gt;）。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;sourcemap如何存储映射关系&lt;/h2&gt;
&lt;p&gt;　　sourcemap的mappings属性的值是将位置映射关系采用Base 64 VLQ编码后生成的字符串。mappings属性值包含的信息可以按照下面的方式进行拆分。&lt;br&gt;
　　（1）生成的bundle文件中的每一行依次对应于mappings属性值中的一个组，组与组之间使用英文输入法中的分号分隔。上文所示的sourcemap示例中mappings包含三个组：&lt;strong&gt;“A,AAAB”&lt;/strong&gt;、&lt;strong&gt;“空”&lt;/strong&gt;和&lt;strong&gt;“ABCDE”&lt;/strong&gt;，分别对应于bundle文件的第&lt;strong&gt;1、2、3&lt;/strong&gt;行；&lt;br&gt;
　　（2）mappings中每个组可以使用英文逗号分隔为多个段，如（1）中的第1组分为两个段，对应的字符序列分别为&lt;strong&gt;“A”&lt;/strong&gt;和&lt;strong&gt;“AAAB”&lt;/strong&gt;；&lt;br&gt;
　　（3）每个段又可以看做是由5个可变长度域组成，段与可变长度域的关系可由图1表示。&lt;/p&gt;
&lt;div style=&quot;text-aligin: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/76d38b0a5fc0b8de44a6f7b846cf9767/045b1/segment_and_field.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 33.401920438957475%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABcSAAAXEgFnn9JSAAABe0lEQVQoz3VQyy5DYRj8Uo0EXWmbLoUjFo1rNETqGkmjUj20jbIXVFgRHoAFEi0PwEKsJPTQnlvTRZvGRjyBhbC18QL6j+8cJUQsJjPzz8x/LkT5GOh6tsoQDPzCVRSt5ioGSjuQCinb/+l87qr2PYp8Q01aBF4zLNxmGD5zytJwG2F4zGl4jRCCd0uIPWxhmNnD3jq3cm+t32xMw1ewWVAuDppUg1gs9IsFMyAmWMv6IJKFAJJGAKPqCGbUPkT0LuZejKnDmOdzK5e1QYxzP8k7ax9Sh0BZuUqvlXrgnAQUwkupASgRcMrQCI+lJqBY88xP5UYgx/qMUSY8l7l/yfqCxFvFCVc2ImjT6MRJvk1kNEls8JvsGR1I5ySkdQkreg8O9Hbs37TgkDmld+NIk+x8l3vr7DOqJI55v2344VSigijL360kBGUTsLXFSgI/vctYxr+58uXjgm7nQA4tBocivzMEA78R5afOwl9cQ92f7BvC3mtz1j+8/wBQiDOE+HprngAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;段与可变长度字段的关系&quot;
        title=&quot;&quot;
        src=&quot;/static/76d38b0a5fc0b8de44a6f7b846cf9767/40fad/segment_and_field.png&quot;
        srcset=&quot;/static/76d38b0a5fc0b8de44a6f7b846cf9767/707e9/segment_and_field.png 148w,
/static/76d38b0a5fc0b8de44a6f7b846cf9767/649e0/segment_and_field.png 295w,
/static/76d38b0a5fc0b8de44a6f7b846cf9767/40fad/segment_and_field.png 590w,
/static/76d38b0a5fc0b8de44a6f7b846cf9767/b3fef/segment_and_field.png 885w,
/static/76d38b0a5fc0b8de44a6f7b846cf9767/301c0/segment_and_field.png 1180w,
/static/76d38b0a5fc0b8de44a6f7b846cf9767/045b1/segment_and_field.png 1458w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 1 段与可变长度域的关系&lt;/div&gt;
&lt;p&gt;　　域是可变长度的字符串的原因在于域值是Base 64 VLQ编码后生成的字符串(VLQ是变长编码)。域包含的信息如下：&lt;br&gt;
　　（1）第一个字段表示的是段对应于bundle文件的第几列（从第0列开始计算）；&lt;br&gt;
　　（2）第二个字段表示的是段对应的源文件在sources属性对应的源文件列表中的索引；&lt;br&gt;
　　（3）第三个字段表示的是段对应于源文件的第几行（从第0行开始计算）；&lt;br&gt;
　　（4）第四个字段表示的是段对应于源文件的第几列（从第0列开始计算）；&lt;br&gt;
　　（5）第五个字段表示的是段对应的变量名或属性在names属性对应的变量名或属性列表中的索引。&lt;br&gt;&lt;/p&gt;
&lt;h2&gt;Base 64 VLQ编码&lt;/h2&gt;
&lt;p&gt;　　VLQ编码是一种采用任意长度的二进制位来表示任意大小的整数的通用编码方式。&lt;a href=&quot;/notes/20180314211238/&quot;&gt;Base 64编码&lt;/a&gt;是将二进制序列分成多个由6个bit组成的数据块（不足补0）并将6bit数据映射成常见字符的编码方式。Base 64 VLQ编码结合了VLQ编码和Base 64编码的特点，它的编码特点如下：&lt;br&gt;
　　（1）对任意整数编码后生成的结果是一个由Base 64字母表中的字符组成的任意长度的字符串。&lt;br&gt;
　　（2）每一个字符对应6bit的二进制位。最高位取1时，表示该6bit后面的6bit和该6bit表示的是同一个整数，最高位取0时，表示整数的编码到该6bit结束。起始6bit的最低位起到标志整数符号的作用，0表示正数，1表示负数，其余的bit组的最低位当做数据位。&lt;br&gt;&lt;/p&gt;
&lt;h2&gt;sourcemap mappings示例&lt;/h2&gt;
&lt;p&gt;　　假设某一个sourcemap的内容如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;version&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;index.min.js&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;sourceRoot&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;sources&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;page1.js&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;page2.js&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;names&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;b&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;c&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;d&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;mappings&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ABCDE;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　对上述mappings解读如下：&lt;br&gt;
　　（1）index.min.js只有一行，只对应于mappings中的一个组 “ABCDE” 。&lt;br&gt;
　　（2）组 “ABCDE” 只包含一个段，“ABCDE”是对段中可变长度域的值进行Base 64 VLQ编码后的结果。&lt;br&gt;
　　（3）将 “ABCDE” 逐个进行Base 64解码，可以得到如下二进制序列：000000 000010 000010 011010 000100。&lt;br&gt;
　　（4）上述解码后得到的5个6bit二进制序列的最高位都为0，表示每一个整数只对应一个6bit单元。每个6bit单元的最低位都是0，表示每一个整数都是正数。上述二进制序列解码后得到的数字序列为0 1 1 13 2。&lt;br&gt;
　　（5）根据段中域的含义，mappings展示出的信息如下：&lt;strong&gt;index.min.js的第1行第0列对应于page2.js文件的第1行第13列，这个位置对应的变量名为c&lt;/strong&gt;。&lt;br&gt;&lt;/p&gt;
&lt;h2&gt;如何关联bundle文件和sourcemap文件&lt;/h2&gt;
&lt;p&gt;　　有两种方法可以关联bundle文件和sourcemap文件：&lt;br&gt;
　　（1）在bundle文件的http响应头部添加如下字段：&lt;code class=&quot;language-text&quot;&gt;SourceMap: &amp;lt;sourcemap url&amp;gt;&lt;/code&gt;。&lt;br&gt;
　　（2）在bundle文件内部添加一行注释：&lt;code class=&quot;language-text&quot;&gt;//# sourceMappingURL=&amp;lt;sourcemap url&amp;gt;&lt;/code&gt;或&lt;code class=&quot;language-text&quot;&gt;/*# sourceMappingURL=&amp;lt;sourcemap url&amp;gt; */&lt;/code&gt;。&lt;/p&gt;
&lt;h2&gt;参考文献&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit?hl=en_US&amp;#x26;pli=1&amp;#x26;pli=1#&quot;&gt;Source Map Revision 3 Proposal&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.html5rocks.com/en/tutorials/developertools/sourcemaps/&quot;&gt;Introduction to JavaScript Source Maps&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html&quot;&gt;JavaScript Source Map 详解&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Variable-length_code&quot;&gt;Wikipedia: Variable-length code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Variable-length_quantity&quot;&gt;Wikipedia: Variable-length quantity&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[meta标签学习笔记]]></title><description><![CDATA[meta标签作用 　　meta标签提供了title、base、link、style和script等标签无法提供的html文档元数据信息。 元数据 　　元数据是用来描述数据的数据。html文档的元数据包括文档作者、描述、关键词、视口大小等信息。html…]]></description><link>https://blog.yanfangyao.guru//notes/20180717214533/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//notes/20180717214533/</guid><pubDate>Tue, 17 Jul 2018 21:45:33 GMT</pubDate><content:encoded>&lt;h2&gt;meta标签作用&lt;/h2&gt;
&lt;p&gt;　　meta标签提供了title、base、link、style和script等标签无法提供的html文档元数据信息。&lt;/p&gt;
&lt;h2&gt;元数据&lt;/h2&gt;
&lt;p&gt;　　元数据是用来描述数据的数据。html文档的元数据包括文档作者、描述、关键词、视口大小等信息。html文档的元数据不会展示在页面上，但会被浏览器或者其他web服务解析。&lt;!-- more --&gt;&lt;/p&gt;
&lt;h2&gt;meta标签属性&lt;/h2&gt;
&lt;p&gt;　　meta标签主要有以下四个属性：&lt;br&gt;
　　（1）&lt;strong&gt;charset&lt;/strong&gt;。该属性用来设置html文档的编码类型，如utf-8。每个html文档最多只能包含一个设置了charset属性的meta标签。&lt;br&gt;
　　（2）&lt;strong&gt;http-equiv&lt;/strong&gt;。该属性用来模拟http响应头的键值信息。&lt;br&gt;
　　（3）&lt;strong&gt;name&lt;/strong&gt;。该属性用来设置html文档元数据的名字。&lt;br&gt;
　　（4）&lt;strong&gt;content&lt;/strong&gt;。该属性用来设置html文档元数据的值。&lt;br&gt;&lt;/p&gt;
&lt;h2&gt;meta标签用法&lt;/h2&gt;
&lt;p&gt;　　每个meta标签只能设置charset、http-equiv、name三个属性中的一个，对于单个meta标签而言，它们是互斥的。name属性和http-equiv属性必须和content属性配对使用。&lt;/p&gt;
&lt;h3&gt;name取值&lt;/h3&gt;
&lt;p&gt;　　标准的name属性值主要有6个：&lt;br&gt;
　　（1）&lt;strong&gt;application-name&lt;/strong&gt;。当name取值为application-name时，content属性值必须设置为当前网页代表的web应用的名字。需要注意的是，在当前网页不是一个web应用的情况下，name属性不能取值为application-name。&lt;br&gt;
　　（2）&lt;strong&gt;author&lt;/strong&gt;。当name取值为author时，content属性值代表的是网站的作者。&lt;br&gt;
　　（3）&lt;strong&gt;description&lt;/strong&gt;。当name取值为description时，content属性值代表的是对当前网页的描述。设置description有利于网页的SEO。一个html文档最多只能由一个meta标签设置description。&lt;br&gt;
　　（4）&lt;strong&gt;generator&lt;/strong&gt;。当name取值为generator时，content属性值记录了用来生成该文档的工具信息。当文档不是由工具生成时，无需使用meta标签设置generator信息。&lt;br&gt;
　　（5）&lt;strong&gt;keywords&lt;/strong&gt;。当name取值为keywords时，content属性值代表了当前html文档的关键词信息，多个关键词可以使用逗号分隔。设置keywords有利与网页的seo。&lt;br&gt;
　　（6）&lt;strong&gt;referrer&lt;/strong&gt;。当name取值为referrer时，content属性值对应于从当前页面跳转到其他页面时，http请求的referrer策略。content取值与http请求的referrer策略及对应的http请求头部的Referer字段取值对应如下：&lt;br&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;content&lt;/th&gt;
&lt;th&gt;referrer&lt;/th&gt;
&lt;th&gt;响应头Referer&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;never&lt;/td&gt;
&lt;td&gt;no-referrer&lt;/td&gt;
&lt;td&gt;删除Referer字段&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;default&lt;/td&gt;
&lt;td&gt;no-referrer-when-downgrade&lt;/td&gt;
&lt;td&gt;如果当前页面使用的是https协议，跳转的页面使用的是http协议，则取值为空。如果当前协议与跳转页面使用的协议一致，则取值为当前页面url的协议、域名、请求参数这三个值拼成的uri&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;always&lt;/td&gt;
&lt;td&gt;unsafe-url&lt;/td&gt;
&lt;td&gt;当前页面url的协议、域名、请求参数拼成的uri&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;origin-when-crossorigin&lt;/td&gt;
&lt;td&gt;origin-when-cross-origin&lt;/td&gt;
&lt;td&gt;跨域时取值与Origin字段一致，不是当前页面的完整url，只是协议和域名拼成的uri&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;　　上述6个值是html5标准规定的name取值。name属性还可以设置为可以被现代浏览器识别的其他非标准值，比如viewport。下面的meta标签设置页面的viewport宽度与设备宽度相同。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;viewport&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;width=device-width&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;http-equiv取值&lt;/h3&gt;
&lt;p&gt;　　http-equiv取值主要有5个：&lt;br&gt;
　　（1）&lt;strong&gt;content-language&lt;/strong&gt;。当http-equiv取值为content-language时，content属性值代表了当前页面所采用的语言类型。设置网页为中文的示例：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;http-equiv&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;content-language&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;zh-CN&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　html5标准并不推荐使用content-language来设置网页语言类型，推荐使用html标签的lang属性代替。使用lang属性设置网页为中文的示例如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;html&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;lang&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;zh-CN&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　（2）&lt;strong&gt;content-type&lt;/strong&gt;。当http-equiv取值为content-type时，content属性取值展示了网页的编码字符集。设置网页为utf-8编码的示例如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;http-equiv&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;content-type&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/html;charset=utf-8&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　推荐使用meta标签的charset属性来替换http-equiv的该功能。使用charset属性设置网页编码字符集的示例如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;charset&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;utf-8&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　（3）&lt;strong&gt;default-style&lt;/strong&gt;。当http-equiv取值为default-style时，content属性值设定了要使用的预定义样式表。content属性取值为当前html文档某一个外链了样式表的link标签的title属性值或某一个style标签的title属性值。&lt;br&gt;
　　（4）&lt;strong&gt;refresh&lt;/strong&gt;。当http-equiv取值为refresh时，content属性值为页面重定向的时间间隔。如设置页面每隔1s自动刷新一次：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;http-equiv&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;refresh&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;1&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　页面1s后重定向到百度首页示例：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;http-equiv&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;refresh&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;1;url=baidu.com&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　（5）&lt;strong&gt;set-cookie&lt;/strong&gt;。当http-equiv取值为set-cookie时，content属性值用来设置网页的cookie。html5标准并不推荐使用这种方法来设置网站的cookie。&lt;/p&gt;
&lt;h2&gt;参考文献&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://www.w3.org/TR/html5/document-metadata.html&quot;&gt;HTML5: document-metadata&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.w3schools.com/Tags/tag_meta.asp&quot;&gt;w3school: HTML &lt;meta&gt; Tag&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://951759534.github.io/2017/06/06/%E5%85%B3%E4%BA%8Emeta%E7%9A%84referer%E5%B1%9E%E6%80%A7/&quot;&gt;关于meta的referer属性&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/1f9c71850299&quot;&gt;简书：origin,referer和host区别&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/3afaf3f00096&quot;&gt;简书：meta标签&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[react组件何时请求异步数据——componentWillMount或者componentDidMount?]]></title><description><![CDATA[问题背景 　　在使用react进行项目开发时，经常会遇到需要在组件中异步请求服务端数据的情况。项目组成员在react组件发送异步请求的时机上往往有分歧，一少部分人支持在生命周期函数componentWillMount…]]></description><link>https://blog.yanfangyao.guru//tips/20180713160854/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//tips/20180713160854/</guid><pubDate>Fri, 13 Jul 2018 16:08:54 GMT</pubDate><content:encoded>&lt;h2&gt;问题背景&lt;/h2&gt;
&lt;p&gt;　　在使用react进行项目开发时，经常会遇到需要在组件中异步请求服务端数据的情况。项目组成员在react组件发送异步请求的时机上往往有分歧，一少部分人支持在生命周期函数componentWillMount中发送请求，更多的人支持在生命周期函数componentDidMount中处理请求。那究竟在哪个生命期函数中处理异步请求较好呢？&lt;/p&gt;
&lt;h2&gt;问题解决方案&lt;/h2&gt;
&lt;p&gt;　　&lt;a href=&quot;https://reactjs.org/blog/2018/03/27/update-on-async-rendering.html#fetching-external-data&quot;&gt;react官方文档&lt;/a&gt;推荐在componentDidMount中处理组件的异步请求，理由如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;如果在componentWillMount中发送异步请求，在SSR（服务端渲染）的情况下，服务端与客户端共用一套组件原代码，此时会发出两次请求（服务端请求一次、客户端请求一次），服务端的请求是多余的。如果将异步请求放在componentDidMount中，服务器不会执行componentDidMount生命周期函数，可以减少不必要的请求。&lt;/li&gt;
&lt;li&gt;从react 16.3开始，componentWillMount这个生命周期函数会被丢弃，于是不建议使用componentWillMount。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;　　&lt;a href=&quot;https://reactjs.org/blog/2018/03/27/update-on-async-rendering.html#fetching-external-data&quot;&gt;react官方文档&lt;/a&gt;还建议，在服务端渲染过程中如果需要在组件渲染前同步获取数据，可以使用constructor替换componentWillMount进行处理。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[现代浏览器的工作原理（三）]]></title><description><![CDATA[解析CSS的流程 　　现代浏览器解析CSS文档的流程如图1所示。 　　现代浏览器解析CSS的流程与解析html的流程类似：从网络或者本地获取CSS文件后，经过解码器、预处理器、标记生成器以及树构建器处理之后生成一个CSSStyleSheet…]]></description><link>https://blog.yanfangyao.guru//notes/20180620190521/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//notes/20180620190521/</guid><pubDate>Wed, 20 Jun 2018 19:05:12 GMT</pubDate><content:encoded>&lt;h2&gt;解析CSS的流程&lt;/h2&gt;
&lt;p&gt;　　现代浏览器解析CSS文档的流程如图1所示。&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9e93268e5bce7bb3004b6cd799202275/0f1a9/css_parsing_flow.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 66.64167916041978%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABcSAAAXEgFnn9JSAAACAElEQVQ4y2NgwAKi5txgAtHhs26Yp695879ow+v/Bete/M/c+OV//LyboSA5IM2cs+Q2A1HAvf8cI4j2nHDewKnnXGvUzMszo2ddnu/QfbbSre+cMEjOpReihiiQuug22IVJC2675C+/t6Bl86PlbVserchZdncJUMwVJJcGVANkE2eg35TLzCDad/Ll1MBpV76mL775Fojf+E+9/BMolwxTEzD1CnEGZiy8CfZO5qKbSmkLbvg3rr+X07LxXkHqghsBIDGYmvSFN4kzMGzmdbALA6ddK8xZ/+Z/6Zp7f8vX3v+dteHDf6BYPkwNEBNnoM8ESID7TTyn4tF3NjhjwdXirIVXy1x7zgQHTDqvAlMDxMQZGD/vFtiFcfNuJSfMv/WhYMW9J/kr7j4Csr8AxRLBaubfYo6dd4s4A936zjNBks95O2CymRw16/KC6FlXFgLZ0zz6L9jC1HhMuECcgVlL7oANzFh8xyF/+d0Z5avvLalcc28pkD0rfdFte4jcbaa0RXeIMzB4+lWwlwOmXcmImn3tT9y86x8TF9x4Hz3n+n//qVfSwHJTrxCfbLIW3QBHSu6Sm0pJ8675Vq66nV2x8lZhzKyrQZkLr4MjJX3BdUZgkiLOwPTFt5mhOSa3YO2z/znL7vzIXHLnTe7yu7/TFt9JAVu69A5z1BzMdAgAg44BbjPLyZoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;现代浏览器解析CSS的流程&quot;
        title=&quot;&quot;
        src=&quot;/static/9e93268e5bce7bb3004b6cd799202275/40fad/css_parsing_flow.png&quot;
        srcset=&quot;/static/9e93268e5bce7bb3004b6cd799202275/707e9/css_parsing_flow.png 148w,
/static/9e93268e5bce7bb3004b6cd799202275/649e0/css_parsing_flow.png 295w,
/static/9e93268e5bce7bb3004b6cd799202275/40fad/css_parsing_flow.png 590w,
/static/9e93268e5bce7bb3004b6cd799202275/b3fef/css_parsing_flow.png 885w,
/static/9e93268e5bce7bb3004b6cd799202275/301c0/css_parsing_flow.png 1180w,
/static/9e93268e5bce7bb3004b6cd799202275/0f1a9/css_parsing_flow.png 1334w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 1 现代浏览器解析CSS的流程&lt;/div&gt;
&lt;p&gt;　　现代浏览器解析CSS的流程与解析html的流程类似：从网络或者本地获取CSS文件后，经过解码器、预处理器、标记生成器以及树构建器处理之后生成一个CSSStyleSheet对象。解析流程中的关键处理步骤说明如下：&lt;br&gt;
　　（1）Byte Stream Decoder（字节流解码器）：将获取到的CSS字节流解析成Unicode编码表示的字符流。关于更多解码细节，可以&lt;a href=&quot;https://www.w3.org/TR/css-syntax-3/#input-byte-stream&quot;&gt;查看CSS3标准&lt;/a&gt;。&lt;br&gt;
　　（2）Input Stream Preprocessor（输入字符流预处理器）：对解码产生的Unicode字符流进行预处理。主要进行如下两个操作：1、将所有的单个 “回车（CR）” 字符、“翻页（FF）” 字符以及 “回车换行（CRLF）” 字符对替换成单个 “换行（LF）” 字符。2、将所有的 “空（U+0000 NULL）” 字符替换成 “替换（U+FFFD REPLACEMENT CHARACTER）” 字符。&lt;br&gt;
　　（3）Tokenizer（标记生成器）：处理步骤（2）生成的字符流，生成CSS标记并将标记传送给树生成器。CSS标记有多种，如标识符标记（&amp;#x3C;ident-token&gt;）、@标记（&amp;#x3C;at-keyword-token&gt;）、数字标记（&amp;#x3C;number-token&gt;）。CSS3标准给出了CSS标记的具体定义，可以&lt;a href=&quot;https://www.w3.org/TR/css-syntax-3/#token-diagrams&quot;&gt;查看CSS3标准&lt;/a&gt;来获得每个CSS标记的具体定义。标记生成器的标记化算法可以用状态机来表示，具体的算法实现流程可以参阅&lt;a href=&quot;https://www.w3.org/TR/css-syntax-3/#tokenizer-algorithms&quot;&gt;CSS3标准&lt;/a&gt;。&lt;br&gt;
　　（4）Tree Construction（树构建）：根据标记生成器产生的一系列CSS标记，构建CSSOM树，树的根节点是CSSStyleSheet对象。CSSStyleSheet对象包含CSSRule对象，CSSRule对象又包含Selectors对象和Declaration对象以及其他与CSS语法对应的对象。&lt;br&gt;&lt;/p&gt;
&lt;h2&gt;解析CSS示例&lt;/h2&gt;
&lt;p&gt;　　按照上述现代浏览器解析CSS文档的流程，以下CSS片段被解析之后生成的CSSOM树如图2所示。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;css&quot;&gt;&lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; blue&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token selector&quot;&gt;div p&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;token property&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 16px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/daf52a76d51f5e166c88249e44616a27/086f1/test_CSSOM.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 58.81284070260448%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABcSAAAXEgFnn9JSAAACxElEQVQoz3VTa0hTYRg+c9NA04ikjH4UXQikH4F/SiQ0FLOaWdh2zjYv85a3qWkEBvojCDVXo5znbO5M18W85eUYM1EJ0h+juZ1dzs4mRaEFaklZ9KM/wdd7loti64OP93zv896e7zwfhv21FD2+oFUaPVGClZNsVvXwB6QZfIcaxtZQEe1bjc3VSgTs0p35P/FhCyfZoM29OYkRBo+4wMTFCGdZN5tS0svPVz4MLFQ88L8qNHH9qc1M9NWRZTHERctJlyiYT7nDi0o7XkTulj8oxtJoCZY/LIkEh4r+QzM04YVbUyLoXFVI+26rzT6dwujVEZT7qIBV0osSwDSAdQPWDlgbTroObU0oEuoQRrgCSBCKRM0ghMl1L2MIg3e5ceo7appYR1fGNhEEK4QkQm/fgRu8a03Wb6iJ+RjE5JRbGsSAPuSJIlIH5wmc8pyFnakwuE8qSGdcCCMoVzIkp8spTzbEncEp166wAjK9MzGr054kvccelpPugzWPl0SnWqxRmZ2Lu9Pb7YlSnX2ninJIFBQbl9Fm256ldewFX8KWGhLy7rNHcu46D2Rr7Xvwbmc8pqT9qHrgLaoZWkEqE4/yuxwZqh4uUD+2jmpBLmVPVgRfCm7w6DWTm6im/zWqGv8MV+FpgQHqNOMbqBp8taNrCGIYDC53oLTPz5T28Yyyhxu6rHcmg+0ss/ifw54GCVmBxX6gqgYdzpVb/KPwY+aAch7sHLWZnwafVd3Lz0JMY5B2YsXEtgiK+C2H49ex2KKn4jD//1YhzS2BYLtCZ6XR2wyT2aHrQrHZ9+y81rYPZKKHCSbSWmfiQehTxTTXISNdF8FnA3YOYKEnKPY0fDuxypFVVGTmZ0MFVSZu8pr1K6obeY/KHr1B57S2Y9DAVmoJ/EhtnUkqtwR+Cq9HRrpv1DFfUP34J1RA80tQsKSB2UC/AICdewGZK9dTAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;CSS解析示例&quot;
        title=&quot;&quot;
        src=&quot;/static/daf52a76d51f5e166c88249e44616a27/40fad/test_CSSOM.png&quot;
        srcset=&quot;/static/daf52a76d51f5e166c88249e44616a27/707e9/test_CSSOM.png 148w,
/static/daf52a76d51f5e166c88249e44616a27/649e0/test_CSSOM.png 295w,
/static/daf52a76d51f5e166c88249e44616a27/40fad/test_CSSOM.png 590w,
/static/daf52a76d51f5e166c88249e44616a27/b3fef/test_CSSOM.png 885w,
/static/daf52a76d51f5e166c88249e44616a27/301c0/test_CSSOM.png 1180w,
/static/daf52a76d51f5e166c88249e44616a27/086f1/test_CSSOM.png 1651w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 2 CSS解析示例&lt;/div&gt;
&lt;h2&gt;构建呈现树&lt;/h2&gt;
&lt;p&gt;　　浏览器在解析构架DOM树的同时，还会构建呈现树。呈现树是由可视化元素按照其显示顺序组成的树，是文档的可视化表示。Firefox将呈现器中的元素称为 “框架(frame)“，Webkit将其称之为 “呈现器(renderer)” 或者 “呈现对象(render object)“。&lt;br&gt;
　　呈现器（呈现对象）知道如何布局以及将自身及其子元素绘制出来。每一个呈现器都代表了一个矩形区域，通常对应于相关节点的CSS框，包含诸如宽度、高度、位置等几何信息。节点CSS样式中display属性的不同，浏览器创建出的呈现器的类型也不同，如inline和block。浏览器创建呈现器时也会考虑元素类型，有些特殊的元素类型对应特殊的呈现器（框架），如表单。&lt;/p&gt;
&lt;h3&gt;呈现树和DOM树的关系&lt;/h3&gt;
&lt;p&gt;　　呈现树与DOM树相对应，但并不是一一对应的。非可视化（注：不包括visibility属性值为hidden的元素）的元素（如head元素、display属性为none的元素）不会被插入到呈现树中。&lt;br&gt;
　　对于一些具有复杂结构的元素，其无法用单一的矩形来描述，浏览器会为这些元素创建多个可视化对象。如select元素有3个呈现器：一个用于显示区域，一个用于下拉列表框，还有一个用于按钮。一个Text节点也可能对应多个可视化对象，如当宽度不够时，文本无法在一行中显示而分为多行，那么新的行也会作为新的呈现器而添加。&lt;br&gt;
　　还有一些呈现对象在呈现树中所处的位置与DOM节点在DOM树中所处的位置并不对应。对于设置了浮动和定位的元素就会出现这种情况，这些元素处于文档的正常流程之外，其对应的呈现对象放置在呈现树的其他地方并映射到真正的呈现器（框架），放在原位的是占位框架。&lt;br&gt;
　　图3显示了DOM树与呈现树的对应关系（&lt;a href=&quot;https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/#Render_tree_construction&quot;&gt;查看原文&lt;/a&gt;）&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a43a99a924a135f54b9ccd937b6c5de5/4ba2c/DOMTreevsRenderTree.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 54.17236662106703%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACOElEQVQoz02Sy2sTQRzH8/cInjx7q6d6KAgi4kE8WXw/EGxRkaJi8WAPSkHFeiqiaKVqG6mWSFvb2tD0kbjdTTKb3W72kX3O7HN2d8ZJjOKHH3P4MZ/5zvCbAmWQnC0IfKm/OixMHhSeHdKX7qRphjGGDA/CANotuz3RroxXdh/sGlMGyQhTCmzJCEnZCZHVbH6dWpwsbkyD2nfbtl3Xjf4ShIH6Tl29sro5uumsOb1IWqA9utEZeWHBA3zrAlD0hohc12HVwzZtiKFRMjaGN/ZG9oJW0JdVjC/J8jAA5XabxnEl8E9Wq9dkmVNVyzDsP7bluKGrltTS9dLOvZ1IjvpyJ8XnQOOMwCk4YR0R49OCcENROkmC4zgIu/jQD7OQJa9dXuPv8qEY9mUpp0fFzkBD47Nugz1+CIDzophblsci7S4IopjG1g9reXiZu80l+0lfttHCPP94rv4QhfMK9qb3pc+1apH/NSnstSwTMt0xjbahLWuN9w2wALgPnFJU/JpPCCkY2tla5YjcHKL+1Rm5ekpwKCEOpsdEs6x5CaI4J4EVbE1sLY4sqt9UMAvWx9blN3JvVITmua3ro9vbJ0BjEDkXk0QKg5eAH+RqA4Zx3LQ/2WpQf8qXx8rWkmUWzep4VZvR+qNK0wjC14pyv16/6brP0wwmyYrjPmo2b0XRk5w0s4jqc5r+UU+EpLPSkd5K6CfqXpv+RxxTz2OFPI/9LaqqkSShfVkXW0DzNJQhL/R87P/b/xvvZj4P/lYDIwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;CSS解析示例&quot;
        title=&quot;&quot;
        src=&quot;/static/a43a99a924a135f54b9ccd937b6c5de5/40fad/DOMTreevsRenderTree.png&quot;
        srcset=&quot;/static/a43a99a924a135f54b9ccd937b6c5de5/707e9/DOMTreevsRenderTree.png 148w,
/static/a43a99a924a135f54b9ccd937b6c5de5/649e0/DOMTreevsRenderTree.png 295w,
/static/a43a99a924a135f54b9ccd937b6c5de5/40fad/DOMTreevsRenderTree.png 590w,
/static/a43a99a924a135f54b9ccd937b6c5de5/4ba2c/DOMTreevsRenderTree.png 731w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 3 DOM树与呈现树的对应关系&lt;/div&gt;
　　在DOM树构建的过程中，浏览器遇到html或者body标记就会创建呈现树的根节点。这个根节点呈现对象对应于CSS的容器block，该block包含了所有其他的block，是最上层的block。这个block的尺寸就是浏览器的视口大小，Firefox称之为ViewPortFrame，Webkit称之为RenderView。呈现树的其余部分将会以DOM树节点插入的形式来创建。
&lt;h2&gt;参考文献&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/&quot;&gt;html5rocks: How Browsers Work: Behind the scenes of modern web browsers&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.w3.org/TR/html5/syntax.html&quot;&gt;HTML: The HTML syntax&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[现代浏览器的工作原理（二）]]></title><description><![CDATA[解析HTML文档流程 　　现代浏览器解析html文档的流程如图1所示（图片摘自 html5标准 ）。 　　上述解析流程中各个处理阶段的功能说明如下： 
　　（1）Byte Stream Decoder（字节流解码器）：将获取到的html文档字节流解析成Unicode…]]></description><link>https://blog.yanfangyao.guru//notes/20180424213011/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//notes/20180424213011/</guid><pubDate>Tue, 24 Apr 2018 21:30:11 GMT</pubDate><content:encoded>&lt;h2&gt;解析HTML文档流程&lt;/h2&gt;
&lt;p&gt;　　现代浏览器解析html文档的流程如图1所示（图片摘自&lt;a href=&quot;https://www.w3.org/TR/html5/syntax.html#parsing-html-documents&quot;&gt;html5标准&lt;/a&gt;）。&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3b0307e1ca3bb2fedf87a48365124d14/c0d9d/html_parsing_flow.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 345px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 155.07246376811594%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAIAAABoLHqZAAAACXBIWXMAAAsTAAALEwEAmpwYAAADd0lEQVQ4y5WVi1PiSBCH/fuvaq9WzlNct+7YOl0FFU5QWVdF3ss7CYlIlFceJBlCQhJCeCSBm6Dlgacr96vJVJLJ193T0zNZm81mlmXJvZ7aV1VN7Sk9We7xPC/LMhyaTqezt7UGL0mVKgIRyV9GiteZu0zbZK6zlyIQ34eNkREB3y4HoWN6/7C1dyb5j2v7xXLhXdKB6Q71Nf/lEPl6jB0coQdebPcsFzRH5mwFOWHPbOhlZo1sqk459/ZsRTmwPtD7el9RlVg8Np6MVVXRdX2lsOHVbDfC8fNYPppGEzfZ6xT+g6gSq8K4hJ5QPveVazv6+5fszjcx9INIrQonG/EddOPPkns7t+HBPm0XXMly3EnF1H4fNiempvY1RaMpRtd0TdVMc+VsT8YTyPf7ejQatW17NBz9D5jhaaRSIqlqqYKUSax8j1WqlcU5T38CYyzyx9XWXuqv3bjnU3jLV9z3nXnbNMMyDE0z7TYHgNCeCwAwmUyW4Hgrsln+4EbW3cjHbdTlKvwSK0ckQWzUayR5D40IgsCyLM0wAgDD4XAJ7inyQ6vWYBrV2l2TbdZaD3BvvbpUw9HQGBrL5Tn/Zjwap5Np58mePpIv5MDD/8BAFGieYgFL1kkgAZqnm63Gqp7r0kNJzISx0wvsLIyeFqV8sVJYFU4y0V3u8xHYPeA8sPc03Tfo1asV9grc4psxNJIiElEkkr5Nwp7mqBee/52zYTzahW/Wnodty8Yx/NVoYdm96Vnsip1uh+XYTC4jKRIntHmBX7QC7fKA78pdim7RLC31ui26Bfe8A9eEh4qE5xuZUOKkSBXwDpZFM7DgYYSPcSIoWhEJXEACN4f+Gz+pVHP1DMdzDpxmEr8VPrjzLrgZt3Lrm8jH69KlNbYHxmA4F35LBKiDz/jGZm59I/Orh9zZu/VwXNuBCbocKPnO8WAQ8Z8TQX/BW2ksnSSWbX3HwyEsEEIDsD/F/w5m/VpfW0iYadfJ+pyZvZUwy7TMibWUMHj0wYQBESRSCVmRBcD3ei9/F/bUms7s8WQE29TJoPW0VAxggCEA3Wkdo8MqTPm2/OqamXMteb7vVEmTSNQjvuR+VkyjRiGJJOAsRnONFwST9zyFJzjbTp/I3ot+MEB7T+6Ojove0l3xuYwWPb94fCrPC+T8OxKG+4Hn+IE2WDT/E/0D9+S6YzH/1JMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;现代浏览器解析html文档的流程&quot;
        title=&quot;&quot;
        src=&quot;/static/3b0307e1ca3bb2fedf87a48365124d14/c0d9d/html_parsing_flow.png&quot;
        srcset=&quot;/static/3b0307e1ca3bb2fedf87a48365124d14/b8469/html_parsing_flow.png 148w,
/static/3b0307e1ca3bb2fedf87a48365124d14/ec75a/html_parsing_flow.png 295w,
/static/3b0307e1ca3bb2fedf87a48365124d14/c0d9d/html_parsing_flow.png 345w&quot;
        sizes=&quot;(max-width: 345px) 100vw, 345px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 1 现代浏览器解析html文档的流程&lt;/div&gt;
&lt;p&gt;　　上述解析流程中各个处理阶段的功能说明如下：&lt;br&gt;
　　（1）Byte Stream Decoder（字节流解码器）：将获取到的html文档字节流解析成Unicode编码表示的字符流。关于更多解码细节，可以&lt;a href=&quot;https://www.w3.org/TR/html5/syntax.html#the-input-byte-stream&quot;&gt;查看html5标准&lt;/a&gt;。&lt;br&gt;
　　（2）Input Stream Preprocessor（输入字符流预处理器）：对解码产生的Unicode字符流进行预处理，如忽略”回车”（CR）后面紧跟的”换行”（LF），然后将所有的”回车”（CR）替换成”换行（LF）“。关于更多预处理字符流的操作，可以&lt;a href=&quot;https://www.w3.org/TR/html5/syntax.html#preprocessing-the-input-stream&quot;&gt;查看html5标准&lt;/a&gt;。&lt;br&gt;
　　（3）Tokenizer（标记生成器）：处理html字符流，生成html标记并将标记传送给树生成器。html标记有以下几种：DOCTYPE、起始标签、结束标签、注释、字符、EOF(文件结束标志)。关于标记生成器的更多细节操作，可以&lt;a href=&quot;https://www.w3.org/TR/html5/syntax.html#tokenization&quot;&gt;查看html5标准&lt;/a&gt;。&lt;br&gt;
　　（4）Tree Construction（树构建）：根据标记生成器产生的一系列html标记，构建DOM树。关于树构建过程的更多细节，可以&lt;a href=&quot;https://www.w3.org/TR/html5/syntax.html#tree-construction&quot;&gt;查看html5标准&lt;/a&gt;。&lt;br&gt;
　　（5）Script Execution（执行脚本）：执行javascript脚本。&lt;/p&gt;
&lt;h2&gt;标记化算法&lt;/h2&gt;
&lt;p&gt;　　标记生成器使用标记化算法从html字符流中提取出html标记用于构建DOM树。由于html语法不是一个与上下文无关的语法，并且解析的过程也可能动态改变html文档（如在树构建的过程中执行document.write()），于是用状态机的形式来表示标记化算法。状态机中的每个状态接受一个或者多个输入字符流中的字符，并且根据这些字符来确定下一个状态。每一次状态的改变是由当前标记状态以及当前树构建状态来决定的。标记化算法具体的实现非常复杂，本文拟通过一个简单的示例来说明标记化算法的基本原理，对其更深入细致的实现不作介绍。关于算法的更多细节，可以&lt;a href=&quot;https://www.w3.org/TR/html5/syntax.html#tokenization&quot;&gt;查看html5标准&lt;/a&gt;。&lt;br&gt;
　　使用标记化算法将下面的html片段标记化：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token doctype&quot;&gt;&amp;lt;!DOCTYPE html&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;解析html文档&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;h1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Hello, world!&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;h1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　上述html片段的标记化过程中各个状态切换流程如下：&lt;br&gt;
　　（1）初始状态为 “数据状态”（Data state）。&lt;br&gt;
　　（2）当遇到字符&amp;#x3C;时，状态切换到 “标签打开状态”（Tag open state）。&lt;br&gt;
　　（3）当遇到字符!时，状态切换至 “标记声明打开状态”（Markup declaration open state）。在该状态下，如果后续两个字符都是连字符-，则创建一个注释标记，设置标记的数据为空，并且跳转到 “注释开始状态”（Comment start state）。如果后续7个字符可以组成字符串 “DOCTYPE”（不区分大小写），则当前状态会跳转到 “DOCTYPE状态”（DOCTYPE state）。根据上述代码片段，当前状态会跳转到 “DOCTYPE状态” 。&lt;br&gt;
　　（4）下一个字符为空格，当前状态切换至 “DOCTYPE名称之前状态”（Before DOCTYPE name state）。&lt;br&gt;
　　（5）当遇到字符串 “html” 时，创建一个新的DOCTYPE标记，标记的名字为 “html” 。然后当前状态切换至 “DOCTYPE名字状态”（DOCTYPE name state）。&lt;br&gt;
　　（6）当遇到字符&gt;，当前状态跳转到 “数据状态” 并且释放当前的DOCTYPE标记。&lt;br&gt;
　　（7）当遇到字符&amp;#x3C;, 当前状态切换到 “标签打开状态” 。&lt;br&gt;
　　（8）遇到字符h，创建一个新的起始标签标记，设置标记的标签名为空，当前状态切换至 “标签名称状态”（Tag name state）。&lt;br&gt;
　　（9）重新从字符h开始解析，将解析的字符一个一个添加到创建的起始标签标记的标签名中，直到遇到字符&gt;。此时当前状态切换至 “数据状态” 并释放当前标记，当前标记的标签名为 “html” 。&lt;br&gt;
　　（10）解析后续的&amp;#x3C;head&gt;和&amp;#x3C;title&gt;的方式与&amp;#x3C;html&gt;一致，创建并释放对应的起始标签标记，解析完毕后，当前状态处于 “数据状态” 。&lt;br&gt;
　　（11）遇到字符串 “解析html文档” ，针对每一个字符，创建并释放一个对应的字符标记，解析完毕后，当前状态仍然处于 “数据状态” 。&lt;br&gt;
　　（12）遇到字符&amp;#x3C;, 进入 “标签打开状态” 。&lt;br&gt;
　　（13）遇到字符/, 进入 “结束标签打开状态”（End tag open state）。&lt;br&gt;
　　（14）遇到字符t，创建一个新的结束标签标记，设置标记的标签名为空，当前状态切换至”标签名称状态”（Tag name state）。&lt;br&gt;
　　（15）重新从字符t开始解析，将解析的字符一个一个添加到创建的结束标签标记的标签名中，直到遇到字符&gt;。此时当前状态切换至 “数据状态” 并释放当前标记，当前标记的标签名为 “title” 。&lt;br&gt;
　　（16）解析&amp;#x3C;/head&gt;的方式与&amp;#x3C;/title&gt;一样。&lt;br&gt;
　　（17）对于后续的html标签和文本的解析，可以参照（1）~（16）的流程来解析。&lt;br&gt;
　　（18）所有的html标签和文本解析完成后，状态切换至 “数据状态” ，一旦遇到文件结束标志符（EOF），则释放EOF标记。&lt;/p&gt;
&lt;h2&gt;树构建算法&lt;/h2&gt;
&lt;p&gt;　　当html解析器被创建的同时，浏览器会创建一个Document对象。在树构建阶段，以Document为根节点的DOM树会得到不断的修改或扩充。标记生成器产生的每个标记被送到树构建器进行处理。html5标准中定义了每类标记对应的DOM元素，当树构建器接收到某个标记时就会创建该标记对应的DOM元素并将该元素插入到DOM树中。为了纠正元素标签嵌套错位的问题和处理未关闭的元素标签，树构建器创建的新DOM元素还会被插入到一个开放元素栈中。树构建算法也可以采用状态机的方式来描述，每个状态都对应一个状态变量insertion mode，该变量可以取值 “initial”、“before html”、“before head”、“after after body” 等。&lt;br&gt;
　　使用树构建算法处理以下html片段生成的标记：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token doctype&quot;&gt;&amp;lt;!DOCTYPE html&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;解析html文档&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;h1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Hello, world!&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;h1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　针对标记化算法创建的标记，使用树构建算法处理的过程中，各个状态的切换流程如下：&lt;br&gt;
　　（1）树构建的初始状态是 “initial” 模式。&lt;br&gt;
　　（2）树构建器接收到标记生成器释放出来的DOCTYPE标记后，树构建器会创建一个DocumentType节点附加在Document节点上，DocumentType节点的name属性为DOCTYPE标记的名字。切换当前的状态为 “before html” 模式。&lt;br&gt;
　　（3）接收到标记生成器释放的起始标签标记（标记名为 “html”）后，树构建器会创建一个HTMLHtmlElement元素（实现了HTMLHtmlElement接口）并将该元素作为Document的子节点插入DOM树中。新创建的HTMLHtmlElement元素也会被插入到一个开放元素栈中。当前状态切换为 “before head” 模式。&lt;br&gt;
　　（4）接收到标记生成器释放的起始标签标记（标签名为 “head”）后，树构建器会创建一个HTMLHeadElement元素（实现了HTMLHeadElement接口）并将该元素作为HTMLHtmlElement元素的子节点插入DOM树中。新创建的HTMLHeadElement元素也会被插入到一个开放元素栈中。当前状态切换为 “in head” 模式。&lt;br&gt;
　　（5）接收到标记生成器释放的起始标签标记（标签名为 “title”）后，树构建器会创建一个HTMLTitleElement元素（实现了HTMLTitleElement接口）并将该元素作为HTMLHeadElement元素的子节点插入DOM树中。新创建的HTMLTitleElement元素也会被插入到一个开放元素栈中。当前状态切换为 “text” 模式。&lt;br&gt;
　　（6）在 “text” 模式下，树构建器会创建一个Text节点（实现了Text接口）并将标记生成器释放的字符标记对应的字符添加到Text节点中。处理完字符标记后，Text节点会作为HTMLTitleElement元素的子节点插入到树中。&lt;br&gt;
　　（7）在 “text” 模式下，接收到标记生成器释放的结束标签标记（标签名为 “title”）后，树构建器会将之前插入开放元素栈的HTMLTitleElement元素弹出。当前状态会返回状态机进入 “text” 模式之前的模式，本例为  “in head” 模式。&lt;br&gt;
　　（8）接收到标记生成器释放的结束标签标记（标签名为 “head”）后，树构建起会将之前插入开放元素栈的HTMLHeadElement元素弹出。当前状态切换至 “after head” 模式。&lt;br&gt;
　　（9）接收到标记生成器释放的起始标签标记（标签名为 “body”）后，树构建器会创建一个HTMLBodyElement元素（实现了HTMLBodyElement接口）并将该元素作为HTMLHtmlElement元素的子节点插入树中。新创建的HTMLBodyElement元素也会被插入到一个开放元素栈中。当前状态切换为 “in body” 模式。&lt;br&gt;
　　（10）接收到标记生成器释放的起始标签标记（标签名为 “h1”）后，树构建器会创建一个HTMLHeadingElement元素（实现了HTMLHeadingElement接口）并将该元素作为HTMLBodyElement元素的子节点插入树中。新创建的HTMLHeadingElement元素也会被插入到一个开放元素栈中。&lt;br&gt;
　　（11）接收到标记生成器释放的字符标记后，树构建器会创建一个Text节点（实现了Text接口）并将标记生成器释放的字符标记对应的字符添加到Text节点中。处理完字符标记后，Text节点会作为HTMLHeadingElement元素的子节点插入到树中。&lt;br&gt;
　　（12）接收到标记生成器释放的结束标签标记（标签名为 “h1”）后，树构建器会将之前插入开放元素栈的HTMLHeadingElement元素弹出。&lt;br&gt;
　　（13）接收到标记生成器释放的结束标签标记（标签名为 “body”）后，树构建起会将之前插入开放元素栈的HTMLBodyElement元素弹出。当前状态切换至 “after body” 模式。&lt;br&gt;
　　（14）接收到标记生成器释放的结束标签标记（标签名为 “html”）后，树构建器会将之前插入开放元素栈的HTMLHtmlElement元素弹出。当前状态切换至 “after after body” 模式。&lt;br&gt;
　　（15）接收到标记生成器释放的EOF标记后，树构建器会停止构建。&lt;br&gt;
　　（16）整个html文档解析过程完成。&lt;br&gt;
　　使用树状图表示树构建器生成的DOM树结构如图2所示：&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3d274b2835d9ef12f533593115d03231/042e5/test_DOM.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 400px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 75.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABcSAAAXEgFnn9JSAAADX0lEQVQ4y5WUWUxTQRSGb2998EENilFDBCUIJhoi4UU0ioCEpUCraFpKhbYsgrIoizEEDAZEWQq0Qi9LF6AsZY/IA5iAiQHaYqFAF6BsgvhgTExADTuMc2/ZxJDoJCfnZs43/+T892QQZHMFYAMonulCjSurVA+4UsM6W2JY5UgMG4Elug2GUHN9N7fv8klrRShpb3GQTAhiA17BUiOIlY+Bx/WfiBwkHQUM4YD7luBdvgLxz+0iztML1IhLvHhHkF0+TuZWTpPZFZOEIBPTmDGwAeqt1xoGDPrtAg0zoGjQhynsO4TXubIJcmj1NMouG0N3dYf893IIFZD27gEA/gaZxUNp9KKhLBiFAcVaER0bwuCNzniNkt6GMosGI1mlWimzRCuDUcMs1gogVwb3OTjDkU2R6AUfdwRjW+dASscieNr+CyS1zYFUJQDwIJ8o2qeiIVKDPl0BiFryux8gqX0ePO8GgCPRK3GkQL1GYgj7EZbIYBJklQxJuFJ9DQSqYFRyxLoW6JkfXruS2ECC9Zggka6aLcZD3xxsyrWBxYNhOBMkHiZDQZSBaXBh0r+b6MQj4OMhcrJl1JsD+3LhNTNoctt3UmzzVxJusl9er5VnjsreK0dp58fvu0YT9LtQ+WpHWn6v+dYZf4Hawjdf7QTrzlSB5qpntvI8hdd7gZanskFwQwMwjYmklJKhZ+po+SS4XzGyFFlpBBGykcXI2hkAW8a2R02sa4iqnQIPKkeXIkzMCuTX2BL9ommOijbnyKUQDZUa+qIh/LBqdDW62rgWVTW6HNP4Za9gY0zDZ4DXcAay6/B7Hf6DZQK4k9eDWKWYRL1zlCc9s1U2XrxeO0qe2sEtU3HWm6ey9eUpzbYEqbnKY545ynPumYozsPVLsF1b2LY1LV91mgBoWR3I5WedJsGXnYedktvNPV59sPDNVV28kdpu5v6i8wQ16/3BbUFezxEoaumW0XUKXup4M1Nh7ZrRZeGR2X3ij5ZJvnw0WKRT4N6FV4wsQF9WQsqGf4ZVTQFWiVawJRgi1dclNM2AuNqxhUfysbXE+vHlhLrx1dAyw/ym4CCRj3LkZOiDLq5pFnpoBHF1EyCmxrj+pPUbgLO4/QLcK9W1hMtn4Ys0vBEPmXCZEXDLjZDRr/4GUUrQZoBY7hsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;DOM树结构&quot;
        title=&quot;&quot;
        src=&quot;/static/3d274b2835d9ef12f533593115d03231/042e5/test_DOM.png&quot;
        srcset=&quot;/static/3d274b2835d9ef12f533593115d03231/aff53/test_DOM.png 148w,
/static/3d274b2835d9ef12f533593115d03231/d25eb/test_DOM.png 295w,
/static/3d274b2835d9ef12f533593115d03231/042e5/test_DOM.png 400w&quot;
        sizes=&quot;(max-width: 400px) 100vw, 400px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 2 树构建器生成的DOM树&lt;/div&gt;
&lt;h2&gt;解析完成后浏览器的动作&lt;/h2&gt;
&lt;p&gt;　　当解析完html文档之后，浏览器会将文档状态标记为 “可交互” ，然后解析并执行处于 “defer” 模式下的javascript脚本。当脚本执行完毕之后，浏览器会在Document对象上触发 “DOMContentLoaded” 事件。当文档依赖的所有其他外部资源（如图片等）下载解析并完毕之后，浏览器会先将文档状态标记为 “完成” ，然后在Window对象上触发 “load” 事件。&lt;/p&gt;
&lt;h2&gt;script标签的defer和async属性&lt;/h2&gt;
&lt;p&gt;　　script标签的defer和async属性可以决定脚本的执行时机。对于type属性取值为 “module” 的script标签来说，设置其defer属性并不起作用，其只支持async属性。&lt;br&gt;
　　对于type属性取值非 “module” 的script标签而言，当设置了async属性后，&lt;strong&gt;浏览器解析到该标签时会另起一个线程获取脚本（当脚本是外部文件时），待脚本准备好后，浏览器会立即解析并执行脚本，在脚本执行过程中，如果DOM解析未完成，则DOM解析暂停&lt;/strong&gt;；当script标签设置了defer属性时，&lt;strong&gt;浏览器解析到该标签时同样会另起一个线程获取脚本（当脚本是外部文件时），与设置async属性不同的是，待脚本准备好后，浏览器并不会立即执行脚本，而是等到DOM解析完毕之后开始执行脚本&lt;/strong&gt;；当没有设置defer或者async属性时，&lt;strong&gt;浏览器解析到script标签时会立即解析并执行脚本，与此同时，DOM的解析被阻塞&lt;/strong&gt;；当script标签同时设置defer和async属性时，&lt;strong&gt;async的优先级高于defer&lt;/strong&gt;。&lt;br&gt;
　　对于type属性取值为 “module” 的script标签而言，当设置了async属性，浏览器解析到script标签时会&lt;strong&gt;另起一个线程获取该module所依赖的其他module，待所有module准备好后，浏览器会立即执行脚本，此时，如果DOM解析未完成，则DOM解析过程暂停&lt;/strong&gt;；当script标签未设置async属性时，&lt;strong&gt;浏览器解析到script标签时同样会另起一个线程获取该module所依赖的其他module，待所有module准备好后，浏览器并不会立即执行脚本，而是等到DOM解析完成后再执行脚本&lt;/strong&gt;。&lt;br&gt;
　　script标签的defer和async属性对脚本执行和DOM解析带来的影响参见图3（引用自&lt;a href=&quot;https://www.w3.org/TR/html5/semantics-scripting.html#element-attrdef-script-defer&quot;&gt;html5标准&lt;/a&gt;）。&lt;/p&gt;
&lt;div style=&quot;height: 10rem;&quot;&gt;
&lt;img width=&quot;100%&quot; height=&quot;100%&quot; src=&quot;/static/script_defer_async_effect-da8316d78a7ba93e18a4dc6dcaaf73e2.svg&quot; alt=&quot;defer&amp;#x548C;async&amp;#x5C5E;&amp;#x6027;&amp;#x5BF9;html&amp;#x89E3;&amp;#x6790;&amp;#x5E26;&amp;#x6765;&amp;#x7684;&amp;#x5F71;&amp;#x54CD;&quot;&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;&amp;#x56FE; 3 defer&amp;#x548C;async&amp;#x5C5E;&amp;#x6027;&amp;#x5BF9;html&amp;#x89E3;&amp;#x6790;&amp;#x5E26;&amp;#x6765;&amp;#x7684;&amp;#x5F71;&amp;#x54CD;&lt;/div&gt;
&lt;h2&gt;参考文献&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/&quot;&gt;html5rocks: How Browsers Work: Behind the scenes of modern web browsers&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.w3.org/TR/html5/syntax.html&quot;&gt;HTML: The HTML syntax&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[解决移动端网页开发“滚动穿透”问题]]></title><description><![CDATA[…]]></description><link>https://blog.yanfangyao.guru//tips/20180422162446/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//tips/20180422162446/</guid><pubDate>Sun, 22 Apr 2018 16:24:46 GMT</pubDate><content:encoded>&lt;h2&gt;问题背景&lt;/h2&gt;
&lt;p&gt;　　在移动端网页中，经常会以弹层的形式来展示信息给用户。在开发弹层时经常会遇到这样一个问题：当用户手指在弹层上滑动时，弹层下面的内容也会跟随手指的滑动一起滚动。这就是移动端网页的 “滚动穿透” 问题。&lt;/p&gt;
&lt;h2&gt;问题产生原因&lt;/h2&gt;
&lt;p&gt;　　当用户手指在弹层上滑动时，默认触发了浏览器的 “scroll” 事件，事件冒泡至body元素，于是就产生了 “滚动穿透” 效果。&lt;/p&gt;
&lt;h2&gt;问题解决方案&lt;/h2&gt;
&lt;p&gt;　　针对移动端页面”滚动穿透”的问题，目前主要有两种解决方案：&lt;br&gt;
　　（1）在touchmove事件处理函数中使用preventDefault()阻止事件的默认动作。当用户手指在弹层上滑动时，浏览器不再触发 “scroll” 事件，“滚动穿透” 现象也就不再发生。但是该解决方案不适用于弹层需要实现滚动的场景。&lt;br&gt;
　　（2）当发起弹层时，设置body元素的position属性为fixed，并且设置body元素向上的偏移量等于此时其已经滚动的距离；当关闭弹层时，恢复body元素的相关属性即可。该方案与方案（1）相比，可以适用于弹层包含滚动的场景，是一个相对完美的解决方案。该方案的核心处理函数的示例代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 发起弹层时调动&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fixBody&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; scrollTop &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scrollTop &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;documentElement&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scrollTop&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;style&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;position &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;fixed&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;style&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;top &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;scrollTop &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;px&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 设置body宽度等于viewport的宽度，防止body子元素宽度大于视口宽度时布局错乱&lt;/span&gt;
    document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;style&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;100%&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 关闭弹层时调用&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;relaxBody&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 清空position属性&lt;/span&gt;
    document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;style&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;position &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 恢复scrollTop&lt;/span&gt;
    document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scrollTop &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;documentElement&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scrollTop &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;parseFloat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;style&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;top&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 清空top属性&lt;/span&gt;
    document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;style&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;top &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 清空width属性&lt;/span&gt;
    document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;style&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;小提示&lt;/h2&gt;
&lt;p&gt;　　对于PC端页面来说，可以设置body元素的overflow属性的值为hidden来解决弹层的 “滚动穿透” 问题。该方案只适用于PC端页面，不适用于移动端页面。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[现代浏览器的工作原理（一）]]></title><description><![CDATA[前言 　　了解浏览器的工作原理是一名前端开发工程师构的必修课。最近，笔者在工作之余，细心研读了以色列开发人员Tali Garsiel针对现代浏览器工作原理的 研究成果 以及 html…]]></description><link>https://blog.yanfangyao.guru//notes/20180412215709/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//notes/20180412215709/</guid><pubDate>Thu, 12 Apr 2018 21:57:09 GMT</pubDate><content:encoded>&lt;h2&gt;前言&lt;/h2&gt;
&lt;p&gt;　　了解浏览器的工作原理是一名前端开发工程师构的必修课。最近，笔者在工作之余，细心研读了以色列开发人员Tali Garsiel针对现代浏览器工作原理的&lt;a href=&quot;https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/&quot;&gt;研究成果&lt;/a&gt;以及&lt;a href=&quot;https://www.w3.org/TR/html5/syntax.html&quot;&gt;html5标准文档&lt;/a&gt;等相关内容，并将自己的心得体会以学习笔记的形式记录下来。&lt;/p&gt;
&lt;h2&gt;现代浏览器的组成结构&lt;/h2&gt;
&lt;p&gt;　　现代浏览器的组成可由图1表示：&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5cfc2e36041f396281ff53391529a8b4/260bc/browser_components.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 450px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 67.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAADtElEQVQ4y12Sa2hbZRzGzwZC5xUv2E2mZkMUp6BuflC/+EGLyBCFybpPKu6DoJ9U1lEYfhjqWk3aLC10M66d13YromtssizZmpzcmiZNcpJzTtO0uZ80za3LPW1uj+9pOoT94eHP+39efjzvhSpZLG81WF+6wbGxBsvGmxwrkC5UPR6hyjCJstsldqEhzjse2cMltxhPoEDT3RSpllH+TZtVXW+u0v1UWTXzMQLLAOMBvAzg8wIeN9q0EaAN2Lx1EzCbiOft+KKID7sNBdXsgW2gadSL/CKaEbufSg+ek5QUw/1lhbxPVImoeH64r6qQn4pPTF6sjCpOV0bOb8+JTlfksq8y45flqfGJgcrAQFcHOGJC1CAC7dRfwL0W4LANeMVKNE/EEvmAl69FWx+R3EfueESHHcChX1a2XvqaxyPUThGgBQmzCHRShvVybwxAoAWs7PTFXBXufB2OTBmujRoC7f+9KOm61Q35xKTrGaUx23VBefW+zTm5pe3XohVZcFJ/REvHtGVgJtNsq7JtsWMymMOVSB5ToQ38uZolsxY6XgvqIvCbJ628MO37YEwVeHNsevHVys0hc8F1De0oAfbqXV3v0uyBtw1eSc+cV/IOzUmOs2nJ+961p781J46f8KUO9hh9kh7iHzWwB/fdsncP6iIv/G1M7r9z5BpJWGFUJCE5ctKZfCAdyH+XDZWGs8GiNBsqSnOhkmwjXJKG+du/5sJlGVlLRS9DVIiUpHZHqu+Hf4JPibA12Xu7SUJL0b2T0GNJPFtNAY0NoJkHNrNA3F9BIlBDjC8iypdQSAAt4m3lyAWS63HYUu5Px7nHRGDkdWqXmLDOqdESgTZNYO+8Nma26wTPgjZunNfEjVZ1xERkNavDjFkVNM1rYrT9etxARDv1CVbzb3RMrk8+KQL3UdSu7VcWTJ1X7tTZPW+cnJFQd9WpS9yhu2cnzuqee/EL4/7He/WPiutzR6jdBGhGnBaBC1QZocFMPTi0Vg3+nG8tfa73Bu5fEhr9nlBZZuFyY1ysNsQJzQ/3kiR+v/8MH4goueXwyNJy8Cee549t/0PzqAMpm/htGKqIJazXXSiCh1CzFjQM97yP3Jkr1MCcax3hArAQhOGzT44+KAgCIpEweI5DPn8bHoaxicA6rVA1udnG1qpZRXGlaY4rTjvZ/NUlvjw1fdmw0D1lqs4pZ6O+i6qwc0KbXL1irX//2sPUPVrtDZNOp/OR7tTr9StqtfpHEei49OVD7t/PPKGRntzzHxyNCv+kOv/WAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;现代浏览器组成&quot;
        title=&quot;&quot;
        src=&quot;/static/5cfc2e36041f396281ff53391529a8b4/260bc/browser_components.png&quot;
        srcset=&quot;/static/5cfc2e36041f396281ff53391529a8b4/0c6a5/browser_components.png 148w,
/static/5cfc2e36041f396281ff53391529a8b4/9f78f/browser_components.png 295w,
/static/5cfc2e36041f396281ff53391529a8b4/260bc/browser_components.png 450w&quot;
        sizes=&quot;(max-width: 450px) 100vw, 450px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 1 现代浏览器的组成结构（图片摘自Tali Garsiel的研究成果）&lt;/div&gt;
&lt;p&gt;　　图1中包含的现代浏览器各组件的功能如下：&lt;br&gt;
　　1. &lt;strong&gt;User Interface(用户界面)&lt;/strong&gt;：浏览器的用户界面通常包含地址栏、前进/后退按钮以及书签栏等。除了用来展示用户请求的页面内容的窗口外，浏览器其他部分均属于用户界面。&lt;br&gt;
　　2. &lt;strong&gt;Browser engine(浏览器引擎)&lt;/strong&gt;：在用户界面和呈现引擎之间传送指令。&lt;br&gt;
　　3. &lt;strong&gt;Rendering engine(呈现引擎)&lt;/strong&gt;：呈现引擎的作用是呈现用户请求的web资源。如用户请求的资源是html文档，则呈现引擎负责解析html以及css，然后将渲染出的页面展示在浏览器窗口。&lt;br&gt;
　　4. &lt;strong&gt;Networking(网络模块)&lt;/strong&gt;：实现网络调用，如http请求。该模块提供了一个跨平台的通用接口。&lt;br&gt;
　　5. &lt;strong&gt;UI backend(用户界面后端)&lt;/strong&gt;：用户界面后端被用来绘制基本组件如组合框和窗口，其向外部暴露了一个跨平台的通用接口，它的底层使用了操作系统的用户界面方法。&lt;br&gt;
　　6. &lt;strong&gt;JavaScript interpreter(JavaScript解释器)&lt;/strong&gt;：用来解析和执行JavaScript。&lt;br&gt;
　　7. &lt;strong&gt;Data storage(数据存储)&lt;/strong&gt;：数据存储属于浏览器的持久层。浏览器可能需要在本地保存数据，如cookies，同时浏览器支持各种存储机制，如localStorage、IndexDB、WebSQL以及FileSystem。&lt;/p&gt;
&lt;h2&gt;浏览器的呈现引擎&lt;/h2&gt;
&lt;p&gt;　　呈现引擎默认可以解析html文档、xml文档以及图片等资源并将解析后的内容展示给用户。通过各种插件（浏览器扩展程序）浏览器还可以展示其他各类型的web资源，如pdf插件可以让浏览器展示pdf文档。不同浏览器使用的呈现引擎也不一样，目前主流的呈现引擎有&lt;a href=&quot;https://webkit.org/&quot;&gt;Webkit&lt;/a&gt;、&lt;a href=&quot;https://www.chromium.org/blink&quot;&gt;Blink&lt;/a&gt;(Webkit的一个分支)、&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Mozilla/Gecko&quot;&gt;Gecko&lt;/a&gt;、&lt;a href=&quot;https://en.wikipedia.org/wiki/Trident_layout_engine&quot;&gt;Trident&lt;/a&gt;、&lt;a href=&quot;https://en.wikipedia.org/wiki/EdgeHTML&quot;&gt;EdgeHTML&lt;/a&gt;(Trident的一个分支)。主流浏览器使用的呈现引擎如表1所示。&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;表 1 主流浏览器所使用的呈现引擎&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;浏览器&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;呈现引擎&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Chrome&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;Blink（Chrome 28+）、Webkit（Chrome 27-）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Safari&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;Webkit&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Firefox&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;Gecko&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Edge&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;EdgeHTML&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;IE&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;Trident&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;呈现引擎的主流程&lt;/h3&gt;
&lt;p&gt;　　当网络模块下载完用户请求的html文档之后，呈现引擎会按照图2所示的流程来解析和呈现html文档中的内容。&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/59390444fc54097acc6074013c028e3a/7c8cd/render_engine_main_flow.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 12.486187845303867%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABcSAAAXEgFnn9JSAAAAoklEQVQI12NgaNniypDeq8GQ1KbH3LnH0n3NWzHWtW/UGTr3qDNWLFFhmH9TTWb1K0X5lc+B7BsqDHVrVBnatitxrnurabL4vizj6peaDA3rlBjq16oxLLory8CQ3qPHyMCgygDE/JVLdfxnXQmXWvZYAciXZGFgUGKQVeO1W3DHyX7eDT+gGBdQDCQnpLb0kabHrMsxnNPPSwH54kCsCMSsAFeOL9h+85V2AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;呈现引擎的主要流程&quot;
        title=&quot;&quot;
        src=&quot;/static/59390444fc54097acc6074013c028e3a/40fad/render_engine_main_flow.png&quot;
        srcset=&quot;/static/59390444fc54097acc6074013c028e3a/707e9/render_engine_main_flow.png 148w,
/static/59390444fc54097acc6074013c028e3a/649e0/render_engine_main_flow.png 295w,
/static/59390444fc54097acc6074013c028e3a/40fad/render_engine_main_flow.png 590w,
/static/59390444fc54097acc6074013c028e3a/b3fef/render_engine_main_flow.png 885w,
/static/59390444fc54097acc6074013c028e3a/301c0/render_engine_main_flow.png 1180w,
/static/59390444fc54097acc6074013c028e3a/b5a53/render_engine_main_flow.png 1770w,
/static/59390444fc54097acc6074013c028e3a/7c8cd/render_engine_main_flow.png 1810w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 2 浏览器呈现引擎的主要流程&lt;/div&gt;
&lt;p&gt;　　图2所示的流程是一个渐进式的流程。为了更好的用户体验，呈现引擎不会等到html文档解析完毕之后再去构建和布局呈现树，而是采用类似流水线式的方式，边解析边呈现。&lt;/p&gt;
&lt;h3&gt;Webkit和Gecko的主要流程对比&lt;/h3&gt;
&lt;p&gt;　　Webkit和Gecko的流程图分别如图3和图4所示：&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/45d5c6c67be54d534928d87334312999/5cdc3/webkit_main_flow.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 500px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 46.4%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACPElEQVQoz2M4d46R+eoVBuaepVWME9cdYPn//z8jAwMDW2/DnHnz+tf9n9Sy8ICvW5gEUIxhxuaDbDP3XwTJM8w+eJGBZNBdvyGagaGaGV0caBgjTk1nzjDGX7nMkN+7rMxg9sErxbP2nY5gYEhh3nR0Y+DqQ6tq9pzfmqgo78i84OjllCUnriyduf+8FkjfklM3WJafu83UtvEhw9OXbIwv3wowPXouzMhw8ybT4ds3GQ52Lm0PnXvg3JfZ+09tTGxdJnfw/MaLe48v/XPsypaZIAPmHbnSNvfwpftT9t3QJcGT6qwgctul03yLj57z6N18Knb6vsvqILHJy+Ypt8xd7Hrq6jqFqkUHOFdduq+/8sJdw7aNL7ifvuRQfP1B0PTRcxFVhv//GZhev2JgnrS+mOnF///g8Jqx/5L9stM3/q+5dPf/wmNXd9bOXm657+yG/1ce7fu/6/Tm6REdeyyWn7n2f/GJq/97Nu1JfPaC8dS7D5z/Hz/nv4nVnfeABjdtvqNctOSKWcuuV0Lbjq0RPXRxi+22I6ssgQbyONWdZl504prugmOXdatXPOe++4hb7t4TEcNbDyUUGY6cU5148pLs+pmbswPnHbm1etHxS0tjW1bJHr24rn/PyVWHj13dVk5S0nj5mv3/jdscP+ftyA2etuvC0hl7TsyYunGr3cHzGw5uO7Tk7JGrO6NA6o5c3sK6+eAKpt1nNjFE9Z9iWHr6JtPiU9eYqld+ZLj/mJvx8QsRpjuPJBgBhcQb7VIb9WoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;webkit的主要流程&quot;
        title=&quot;&quot;
        src=&quot;/static/45d5c6c67be54d534928d87334312999/5cdc3/webkit_main_flow.png&quot;
        srcset=&quot;/static/45d5c6c67be54d534928d87334312999/770e1/webkit_main_flow.png 148w,
/static/45d5c6c67be54d534928d87334312999/80002/webkit_main_flow.png 295w,
/static/45d5c6c67be54d534928d87334312999/5cdc3/webkit_main_flow.png 500w&quot;
        sizes=&quot;(max-width: 500px) 100vw, 500px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 3 Webkit的主要流程（图片摘自Tali Garsiel的研究成果）&lt;/div&gt;&lt;br&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8044d900d97479907ad635861768fa5f/adc74/gecko_main_flow.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 500px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 46.4%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAAB3FWwJGJ//8QAGBABAQADAAAAAAAAAAAAAAAAAAIRITH/2gAIAQEAAQUCbZUnj//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/ASf/xAAYEAACAwAAAAAAAAAAAAAAAAAAICExMv/aAAgBAQAGPwLRBSf/xAAdEAABBAIDAAAAAAAAAAAAAAABABEhMRBBUYGR/9oACAEBAAE/IS708QIQEA6TuSv2M/8A/9oADAMBAAIAAwAAABBzz//EABcRAAMBAAAAAAAAAAAAAAAAAAEQETH/2gAIAQMBAT8QOxf/xAAXEQEBAQEAAAAAAAAAAAAAAAABABFR/9oACAECAQE/EFpI9v/EABwQAQACAQUAAAAAAAAAAAAAAAEAETEQIUFxkf/aAAgBAQABPxBGlFJswQM5AKSDA1+TPDH26f/Z&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;gecko的主要流程&quot;
        title=&quot;&quot;
        src=&quot;/static/8044d900d97479907ad635861768fa5f/adc74/gecko_main_flow.jpg&quot;
        srcset=&quot;/static/8044d900d97479907ad635861768fa5f/e40b4/gecko_main_flow.jpg 148w,
/static/8044d900d97479907ad635861768fa5f/ead33/gecko_main_flow.jpg 295w,
/static/8044d900d97479907ad635861768fa5f/adc74/gecko_main_flow.jpg 500w&quot;
        sizes=&quot;(max-width: 500px) 100vw, 500px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 4 Gecko的主要流程（图片摘自Tali Garsiel的研究成果）&lt;/div&gt;
&lt;p&gt;　　从图3和图4可以看出，Webkit和Gecko的主要流程除了部分术语不同之外，逻辑基本一致。&lt;/p&gt;
&lt;h2&gt;参考文献&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/&quot;&gt;Html5rocks: How Browsers Work: Behind the scenes of modern web browsers&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.w3.org/TR/html5/syntax.html&quot;&gt;HTML: The HTML syntax&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.zybuluo.com/yangfch3/note/671516&quot;&gt;浏览器内核、JS 引擎、页面呈现原理及其优化&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[querySelector/querySelectorAll遍历元素的顺序]]></title><description><![CDATA[问题背景 　　在项目开发中，querySelector/querySelectorAll经常被用来选择目标元素。最近笔者在开发图片轮播组件时使用querySelectorAll…]]></description><link>https://blog.yanfangyao.guru//notes/20180411213829/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//notes/20180411213829/</guid><pubDate>Wed, 11 Apr 2018 21:38:29 GMT</pubDate><content:encoded>&lt;h2&gt;问题背景&lt;/h2&gt;
&lt;p&gt;　　在项目开发中，querySelector/querySelectorAll经常被用来选择目标元素。最近笔者在开发图片轮播组件时使用querySelectorAll来选择待轮播的图片元素，然后拟将返回的列表中元素的排列顺序当做元素的展示顺序。这时有一个问题不禁困扰着笔者，querySelectorAll返回的元素列表中的元素究竟是以何种顺序排列？笔者查阅了相关资料，弄清楚了querySelector/querySelectorAll遍历元素的顺序。&lt;/p&gt;
&lt;h2&gt;问题解答&lt;/h2&gt;
&lt;p&gt;　　关于querySelector/querySelectorAll遍历元素的顺序，&lt;a href=&quot;https://www.w3.org/TR/selectors-api/#queryselector&quot;&gt;Selectors API文档&lt;/a&gt;已经进行了详细的描述：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The querySelector() methods on the Document, DocumentFragment, and Element interfaces must return the first matching Element node within the subtrees of the context node. If there is no matching Element, the method must return null.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;The querySelectorAll() methods on the Document, DocumentFragment, and Element interfaces must return a NodeList containing all of the matching Element nodes within the subtrees of the context node, in document order. If there are no matching nodes, the method must return an empty NodeList.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;　　根据文档的描述，可以作如下总结：querySelectorAll按照文档顺序（document order）来遍历所有元素，并且将查找到的目标元素依次存储到一个列表，最后返回该列表；querySelector只返回查找到的第一个目标元素。&lt;br&gt;
　　&lt;a href=&quot;https://www.w3.org/TR/selectors-api/#document-order&quot;&gt;Selectors API文档&lt;/a&gt;对文档顺序（document order）的定义如下：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The term document order means a depth-first pre-order traversal of the DOM tree or subtree in question. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;　　根据文档的描述，文档顺序是&lt;strong&gt;按照深度优先结合先序遍历的方式遍历DOM树及其子树的顺序&lt;/strong&gt;。&lt;br&gt;
　　DOM树构建时元素节点的插入顺序直接影响了querySelector/querySelectorAll遍历元素的顺序。浏览器构建DOM树时元素节点的插入顺序又是怎样的呢？&lt;br&gt;
　　根据以色列的开发者Tali Garsiel的&lt;a href=&quot;https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/&quot;&gt;研究成果&lt;/a&gt;以及&lt;a href=&quot;https://www.w3.org/TR/html5/syntax.html&quot;&gt;html5标准&lt;/a&gt;可以知道，&lt;strong&gt;浏览器是按照html文档字节流的顺序来解析html文档并生成DOM树的&lt;/strong&gt;，即元素插入到DOM树的顺序是元素在html文档字节流中出现的先后顺序。&lt;br&gt;
　　根据上述内容可以得出如下结论：&lt;strong&gt;querySelector/querySelectorAll遍历元素的顺序与元素在html文档字节流中出现的顺序一致&lt;/strong&gt;。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[移动端浏览器click事件延迟触发的研究]]></title><description><![CDATA[click事件延迟触发原因 　　为了优化PC站页面在移动设备上的显示，现代移动端浏览器默认开启页面双击缩放功能。为了判断用户当前手势是单击还是双击，浏览器在touchend事件触发后设置了一个300ms…]]></description><link>https://blog.yanfangyao.guru//notes/20180321215307/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//notes/20180321215307/</guid><pubDate>Wed, 21 Mar 2018 21:53:07 GMT</pubDate><content:encoded>&lt;h2&gt;click事件延迟触发原因&lt;/h2&gt;
&lt;p&gt;　　为了优化PC站页面在移动设备上的显示，现代移动端浏览器默认开启页面双击缩放功能。为了判断用户当前手势是单击还是双击，浏览器在touchend事件触发后设置了一个300ms左右的延时。如果在该延时内用户再次触摸屏幕，则浏览器判定当前用户手势是双击，否则为单击并且触发click事件。因此，移动端浏览器click事件延迟触发的根本原因在于浏览器&lt;strong&gt;支持页面双击缩放&lt;/strong&gt;。&lt;br&gt;
　　在Chrome 65、Firefox 10.6和Safari(iOS 11.2)上验证click事件的延迟触发，测试结果依次展示如下：&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;img width=&quot;33%&quot; src=&quot;/static/click_test_chrome65-07d9c4da6adc4f3a0b4b5ec8d83394b6.gif&quot; alt=&quot;Chrome 65&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&quot;&gt;
&lt;img width=&quot;33%&quot; src=&quot;/static/click_test_firefox10_6-fe1f0d9900967bc70227391edf5de002.gif&quot; alt=&quot;Firefox 10.6&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&quot;&gt;
&lt;img width=&quot;33%&quot; src=&quot;/static/click_test_safari_ios_11_2-cb9330427998e680b7eb740752a0536e.gif&quot; alt=&quot;Safari(iOS 11.2)&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&quot;&gt;
&lt;/div&gt;
&lt;h2&gt;解决click事件延迟触发的方案&lt;/h2&gt;
&lt;p&gt;　　移动端浏览器click事件的延迟触发会损害用户体验，针对延迟产生的原因，目前主要有以下解决方案：&lt;br&gt;
　　（1）&lt;strong&gt;禁止页面缩放&lt;/strong&gt;。在页面html文档的head标签中插入如下meta标签中的任何一个会禁止页面的缩放功能。浏览器检测到页面缩放功能被禁止之后会消除click事件的300ms延时，实现快速点击。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;viewport&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;user-scalable=no&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;viewport&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;initial-scale=1,minimum-scale=1,maximum-scale=1&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　在Chrome 65、Firefox 10.6和Safari(iOS 11.2)上验证该方案的可行性，测试结果依次展示如下：&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;img width=&quot;33%&quot; src=&quot;/static/click_test_chrome65_s1-00d27747f65072de515d5e67780ac124.gif&quot; alt=&quot;Chrome 65&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&quot;&gt;
&lt;img width=&quot;33%&quot; src=&quot;/static/click_test_firefox10_6_s1-fcaae1c2c205ddbf3881193fe6c410f5.gif&quot; alt=&quot;Firefox 10.6&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&quot;&gt;
&lt;img width=&quot;33%&quot; src=&quot;/static/click_test_safari_ios_11_2_s1-ea567fe71dd8539fcc5920b50fb28b86.gif&quot; alt=&quot;Safari(iOS 11.2)&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&quot;&gt;
&lt;/div&gt;
&amp;#x3000;&amp;#x3000;&amp;#x6839;&amp;#x636E;&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;&amp;#x8BE5;&amp;#x65B9;&amp;#x6848;&amp;#x53EA;&amp;#x5728;Chrome&amp;#x548C;Firefox&amp;#x4E2D;&amp;#x751F;&amp;#x6548;&amp;#xFF0C;&amp;#x5728;Safari&amp;#x4E2D;&amp;#x4E0D;&amp;#x8D77;&amp;#x4F5C;&amp;#x7528;&amp;#x3002;&amp;#x6D4B;&amp;#x8BD5;&amp;#x53D1;&amp;#x73B0;&amp;#xFF0C;&amp;#x5728;Chrome&amp;#x548C;Firefox&amp;#x4E2D;&amp;#x4F7F;&amp;#x7528;&amp;#x8BE5;&amp;#x65B9;&amp;#x6848;&amp;#x65F6;&amp;#xFF0C;&amp;#x7F51;&amp;#x9875;&amp;#x4E0D;&amp;#x80FD;&amp;#x88AB;&amp;#x7F29;&amp;#x653E;&amp;#xFF08;&amp;#x5305;&amp;#x62EC;&amp;#x53CC;&amp;#x51FB;&amp;#x7F29;&amp;#x653E;&amp;#x548C;&amp;#x53CC;&amp;#x6307;&amp;#x7F29;&amp;#x653E;&amp;#xFF09;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x5728;Safari&amp;#x6D4F;&amp;#x89C8;&amp;#x5668;&amp;#x4E2D;&amp;#xFF0C;&amp;#x7F51;&amp;#x9875;&amp;#x4ECD;&amp;#x7136;&amp;#x53EF;&amp;#x4EE5;&amp;#x88AB;&amp;#x7F29;&amp;#x653E;&amp;#xFF08;&amp;#x5305;&amp;#x62EC;&amp;#x53CC;&amp;#x51FB;&amp;#x7F29;&amp;#x653E;&amp;#x548C;&amp;#x53CC;&amp;#x6307;&amp;#x7F29;&amp;#x653E;&amp;#xFF09;&amp;#x3002;
&lt;p&gt;　　（2）&lt;strong&gt;设置浏览器视口宽度等于设备屏幕宽度&lt;/strong&gt;。该方法的原理在于当浏览器检测到页面设置的视口宽度小于或者等于设备宽度时，就会认为该页面已经针对移动端设备进行优化了页面，不需要双击缩放功能来保证页面在移动设备上的合理展示，因此，浏览器会禁用页面的双击缩放功能。此时，click事件延时触发的问题也自然被消除。在页面html文档的head标签中插入如下meta标签可以设置浏览器视口等于设备宽度。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;viewport&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;width=device-width&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　在Chrome 65、Firefox 10.6和Safari(iOS 11.2)上验证该方案的可行性，测试结果依次展示如下：&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;img width=&quot;33%&quot; src=&quot;/static/click_test_chrome65_s2-1f4606fd881eaa58b427b0a6d1b7000d.gif&quot; alt=&quot;Chrome 65&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&quot;&gt;
&lt;img width=&quot;33%&quot; src=&quot;/static/click_test_firefox10_6_s2-3673e295fb62a6320083e944d7924d4f.gif&quot; alt=&quot;Firefox 10.6&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&quot;&gt;
&lt;img width=&quot;33%&quot; src=&quot;/static/click_test_safari_ios_11_2_s2-568aaa8b559464fb6215d8528bffb769.gif&quot; alt=&quot;Safari(iOS 11.2)&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&quot;&gt;
&lt;/div&gt;
&amp;#x3000;&amp;#x3000;&amp;#x6839;&amp;#x636E;&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x51FA;&amp;#xFF0C;&amp;#x8BE5;&amp;#x65B9;&amp;#x6CD5;&amp;#x5728;Chrome&amp;#x3001;Firefox&amp;#x548C;Safari&amp;#x4E0A;&amp;#x5747;&amp;#x53EF;&amp;#x4EE5;&amp;#x6D88;&amp;#x9664;click&amp;#x4E8B;&amp;#x4EF6;&amp;#x5EF6;&amp;#x8FDF;300s&amp;#x89E6;&amp;#x53D1;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#x3002;&amp;#x8BE5;&amp;#x65B9;&amp;#x6CD5;&amp;#x867D;&amp;#x7136;&amp;#x7981;&amp;#x6B62;&amp;#x4E86;&amp;#x9875;&amp;#x9762;&amp;#x7684;&amp;#x53CC;&amp;#x51FB;&amp;#x7F29;&amp;#x653E;&amp;#x529F;&amp;#x80FD;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x4FDD;&amp;#x7559;&amp;#x4E86;&amp;#x9875;&amp;#x9762;&amp;#x7684;&amp;#x53CC;&amp;#x6307;&amp;#x7F29;&amp;#x653E;&amp;#x529F;&amp;#x80FD;&amp;#x3002;&amp;#x6D4B;&amp;#x8BD5;&amp;#x53D1;&amp;#x73B0;&amp;#xFF0C;&amp;#x4E00;&amp;#x65E6;&amp;#x7528;&amp;#x6237;&amp;#x4F7F;&amp;#x7528;&amp;#x4E86;&amp;#x9875;&amp;#x9762;&amp;#x7684;&amp;#x53CC;&amp;#x6307;&amp;#x7F29;&amp;#x653E;&amp;#x529F;&amp;#x80FD;&amp;#xFF0C;&amp;#x5728;&amp;#x9875;&amp;#x9762;&amp;#x5904;&amp;#x4E8E;&amp;#x653E;&amp;#x5927;&amp;#x7684;&amp;#x72B6;&amp;#x6001;&amp;#x4E0B;&amp;#xFF0C;&amp;#x6D4F;&amp;#x89C8;&amp;#x5668;&amp;#x7684;click&amp;#x4E8B;&amp;#x4EF6;&amp;#x89E6;&amp;#x53D1;&amp;#x4F1A;&amp;#x518D;&amp;#x6B21;&amp;#x5177;&amp;#x6709;300ms&amp;#x5EF6;&amp;#x8FDF;&amp;#xFF0C;&amp;#x5F53;&amp;#x9875;&amp;#x9762;&amp;#x6062;&amp;#x590D;&amp;#x81F3;&amp;#x521D;&amp;#x59CB;&amp;#x72B6;&amp;#x6001;&amp;#x540E;&amp;#xFF0C;&amp;#x6D4F;&amp;#x89C8;&amp;#x5668;click&amp;#x4E8B;&amp;#x4EF6;&amp;#x89E6;&amp;#x53D1;&amp;#x5EF6;&amp;#x8FDF;&amp;#x53C8;&amp;#x4F1A;&amp;#x6D88;&amp;#x9664;&amp;#x3002;
&lt;p&gt;　　（3）&lt;strong&gt;使用CSS属性touch-action&lt;/strong&gt;。通过给页面所有元素或者特定的元素设置touch-action属性可以保证点击对应的元素时click事件响应无延时。设置方法如下:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;css&quot;&gt;&lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;[selector]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;touch-action&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; manipulation&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　在Chrome 65、Firefox 10.6和Safari(iOS 11.2)上验证该方案的可行性，测试结果依次展示如下：&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;img width=&quot;33%&quot; src=&quot;/static/click_test_chrome65_s3-862b299562a47f2b7ec03878502f1652.gif&quot; alt=&quot;Chrome 65&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&quot;&gt;
&lt;img width=&quot;33%&quot; src=&quot;/static/click_test_firefox10_6_s3-e7c833ba5b1d39ea32609e9bfd2a9c08.gif&quot; alt=&quot;Firefox 10.6&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&quot;&gt;
&lt;img width=&quot;33%&quot; src=&quot;/static/click_test_safari_ios_11_2_s3-c6efa36869211a933164e7e1ecca8d12.gif&quot; alt=&quot;Safari(iOS 11.2)&amp;#x6D4B;&amp;#x8BD5;&amp;#x7ED3;&amp;#x679C;&quot;&gt;
&lt;/div&gt;
&lt;p&gt;　　根据测试结果可以看出，在Chrome、Firefox和Safari浏览器上使用该方法均可以消除click事件的触发延迟。从&lt;a href=&quot;https://caniuse.com/#search=touch-action&quot;&gt;caniuse官网&lt;/a&gt;查询可知，Chrome 36+、Firefox 52+完全支持该属性，Safari 9.3+支持该属性的部分功能。&lt;br&gt;
　　（4）使用&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/Events/touchend&quot;&gt;touchend&lt;/a&gt;事件替换click事件。&lt;br&gt;
　　（5）使用FT Labs开发的开源库&lt;a href=&quot;https://github.com/ftlabs/fastclick&quot;&gt;fastclick&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;总结&lt;/h2&gt;
&lt;p&gt;　　移动端浏览器的click事件触发具有300ms的延迟是浏览器为了支持页面的双击缩放而引入的一个特性。为了消除这一特性给用户体验带来的不好影响，可以根据项目实际情况对上述五种方案进行选择，确定最合适的方案。&lt;/p&gt;
&lt;h2&gt;参考文献&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://developers.google.com/web/updates/2013/12/300ms-tap-delay-gone-away&quot;&gt;Google developers: 300ms tap delay, gone away&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.sitepoint.com/5-ways-prevent-300ms-click-delay-mobile-devices/&quot;&gt;Sitepoint: 5 Ways to Prevent the 300ms Click Delay on Mobile Devices&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://codereview.chromium.org/18850005/#ps106001&quot;&gt;Chromium Code Reviews: Disable double tap zoom on mobile sites, to remove 300ms click delay&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://baishusama.github.io/2017/03/27/%E7%A7%BB%E5%8A%A8%E7%AB%AF-click-%E4%BA%8B%E4%BB%B6%E7%9A%84-300ms-%E5%BB%B6%E8%BF%9F/&quot;&gt;移动端 click 事件 300ms 延迟的前世今生&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[Base-64编码学习笔记]]></title><description><![CDATA[Base-64编码原理 　　Base-64编码的目的是将任意一组字节转换成由常见的文本字符组成的字符序列。Base-64编码的实现流程如下： 首先将待编码的二进制序列划分成多个块，每块包含6个bit。由于一个字节对应8个bit…]]></description><link>https://blog.yanfangyao.guru//notes/20180314211238/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//notes/20180314211238/</guid><pubDate>Wed, 14 Mar 2018 21:12:38 GMT</pubDate><content:encoded>&lt;h2&gt;Base-64编码原理&lt;/h2&gt;
&lt;p&gt;　　Base-64编码的目的是将任意一组字节转换成由常见的文本字符组成的字符序列。Base-64编码的实现流程如下：&lt;br&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;首先将待编码的二进制序列划分成多个块，每块包含6个bit。由于一个字节对应8个bit，可能会遇到二进制序列不能均分为多个块的情况，为了解决这一问题，需要在原来二进制序列的尾部填充0，使得二进制序列的长度为24（6和8的最小公倍数）的整数倍。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;然后按照图1中所示的Base-64字母表（截图自&lt;a href=&quot;https://zh.wikipedia.org/wiki/Base64&quot;&gt;维基百科&lt;/a&gt;）中的对应关系将拆分成的6位块映射成对应的字符。对于完全填充块（完全不包含原始二进制序列中bit位信息的6位块）来说，其由特殊的第65个字符”=”表示。&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/73b3b2877ef703f0912c0792c77f4a91/042e5/base64.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 400px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 132.5%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAABYlAAAWJQFJUiTwAAAEW0lEQVRIx1VVaW/bVhDU//8rRdGigBM0jeM4V1EjrqMo8iXq4CHx0sFTkltwNzP7KLf5QJCi3ps3Mzu7HFxcfujOXv4h38YPcvbilaySXO4eJvLrb2cyHN3J6/O38vXbveSbnfz08y9ydT2UD5/+kst3n6SoGnn95q2cX7yXm+FYfn91LoOb4Ug+/nmls0Won6+/6HpbqB8u9fL9R3305nrzZaQLP9KirPXNxTsdje/1/sHT8d2j1u1Br/8e6tXnG/Vmvn4d3eqgxCmb7U73h6OsN1up27207UHCKJJmf5QkTaWsamnxHEZLrC2kKEsw3srh6V+Jk0Si5Uoa7MvytQw2u4KLdLsrZRUnWtWtsVmuEt3hvopT3RWV1s1eAahptlYcrEmaa3t4wrrY3nPPGsQGBNruAFiUZGAbiwpAAAR7jZP/AGfzhcZphs2V5ustAI+6XK7UDyIt60apdIA/jBlOEG6umhZAtU4mUzCsbMMPgFjDZxAxQD8IdBGERgI2kGFB7www32x6wMYBUQb+4+kEgVea5Rt75mENipJluSa4KJlKB9AN4zOyEvrBxRUA5gvfFlEG3/GazmbmXY1D4b2iUJqAcZxkRmK7JSDyRaMhCxl0cijx/uHRZPAwykMVdeJNbTOZJNizPz5BcoiYRcaY1hmgo1wJDadkmu73vqTuPzto4QfG0IoCK8iQqpgIrqU9FhtugkyrNsPKDVFf8XztfOUzfSUQMmsALEq0XFpsqKDCO6syK0eGlkNspmRvOrNNvh8+S57O5iaZhyDElkOCkSX9JrE+NqlVefk/wInnAFlZAtYnQNgCm5xkY7gCKKNVOkAyo0TeEwA2JrnWx8nEuialr6g633vTqQHyN0EPx380REECXKw817qiwGgwMw9PrceFvFMaI0HmUeRySAUEZFFoUwTJXGNFydYbNHdMBkJpBDTJE88A6RcXuxw6yZTH1tvDwwBpmC8CW5OcGNLDdn+wjrFeBhBzyA6JY9fTLMoKTLiGSkDEcsjKJ31/94Bbk4wCcCQ5yShG0Etmp/AdL8qjVAKeckgQl02nZgAjZcFooFNY5VOfjm/v7O5Or5+rzM1ufGVWFIadQ4M2MT6IzUbYj+xlemOTBPcZNtv4iu0/A+Rm156tsWRsqISEXOXZKRgOpAo2QqNPrbeydmpMBi2g5NOA5bOFfX/4ocokNMD4scHKATubz20RAcbjW7u7adM6hphAp95mfA5PTjIHLNea5LQHBLpVu+qnzWMfm6SPCQE5MDhlin5OWg6hhCy5xqpMD+37QcBV33plZaNqZ0zWzxObbGI2Qe08ZPfE/TzkGhZskOe5BZtfP/wpDDj7Gq0n2MhJJJxEfO95U0bMvoLML6osYC1BuLSvHteZhzbPIOP0vaBHp9az8VX34wsesSileVs8DwdersNK87DjKaDc8Rnd0UFOhwJ0MLqDV/aOz5Dcpfmmw4EdDurAGu98XGEHhR0O6b4DQujm4jpll1EAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;base-64字母表&quot;
        title=&quot;&quot;
        src=&quot;/static/73b3b2877ef703f0912c0792c77f4a91/042e5/base64.png&quot;
        srcset=&quot;/static/73b3b2877ef703f0912c0792c77f4a91/aff53/base64.png 148w,
/static/73b3b2877ef703f0912c0792c77f4a91/d25eb/base64.png 295w,
/static/73b3b2877ef703f0912c0792c77f4a91/042e5/base64.png 400w&quot;
        sizes=&quot;(max-width: 400px) 100vw, 400px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 1 Base-64字母表&lt;/div&gt;
&lt;h2&gt;Base-64编码实例&lt;/h2&gt;
&lt;p&gt;　　以对字符串”OK”进行Base-64编码为例，其编码过程如下。&lt;br&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;将字符 “O” 和 “K” 的ASCII编码值以二进制的表示。 “O” 对应的二进制序列为 “01001111”，“K” 对应的二进制序列为 “01001011”。字符串 “OK” 对应的二进制序列为 “0100111101001011”。&lt;/li&gt;
&lt;li&gt;在末尾填充字符串 “OK” 对应的二进制序列，使其长度达到24的整数倍。填充后的二进制序列为 “010011110100101100000000”。&lt;/li&gt;
&lt;li&gt;经过填充后的原字符串对应的二进制序列可以均分为四个6位块，分别为 “010011”、“110100”、“101100”、“000000”。&lt;/li&gt;
&lt;li&gt;将非完全填充块转换成十进制数，查阅图1中所示的Base-64字母表实现编码映射。对于完全填充块而言，将其映射为字符”=”。“010011” 映射为字符 “T”、“110100” 映射为字符 “0”、“101100” 映射为字符 “s”、“000000” 映射为字符 “=”。&lt;/li&gt;
&lt;li&gt;对字符串进行Base-64编码后得到的常见的文本字符序列为 “T0s=”。&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[WebSocket协议学习笔记]]></title><description><![CDATA[协议产生背景 　　http协议是一个单向、无连接、无状态的协议。因为协议的特性，在客户端需要即时获取服务端变动的业务场景下，http协议通信效率低下。为了弥补http协议这方面的缺陷，人们设计出了WebSocket协议。该协议建立在http协议的基础上，对http…]]></description><link>https://blog.yanfangyao.guru//notes/20180312213842/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//notes/20180312213842/</guid><pubDate>Mon, 12 Mar 2018 21:38:42 GMT</pubDate><content:encoded>&lt;h2&gt;协议产生背景&lt;/h2&gt;
&lt;p&gt;　　http协议是一个单向、无连接、无状态的协议。因为协议的特性，在客户端需要即时获取服务端变动的业务场景下，http协议通信效率低下。为了弥补http协议这方面的缺陷，人们设计出了WebSocket协议。该协议建立在http协议的基础上，对http协议的功能进行了扩展。图1展示了WebSocket协议和http协议的关系。&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/07e7ff97417a607f47c3012b032b39a5/7d191/http_websocket.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 37.7959927140255%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABu0lEQVQoz12R2Y4SURRFq1GGAmouipoH4BbI0AxFMCHaaU2bGBPTb774A/7/DywPhfrgw07OvblZWXcfbdgxuWWgGbhDlywISCcJm+0Tl+t3mstXFrMjRbohcEusvs0ijXg3SznvKi6PM5pNxbJMqaIQTX8w/gEd3eZQx1RxQhqvUfMzanEmz/ZUZUOZn7D0UKAWZs8mmwQCn1IEHs7AwBs5aMOOxfCN1UL1tz6ZgKxRShwoimyLa8TU2ZRVEaHSkP0y57QuxapkVcaEvqIsTpID466H1tf6dLUeujbAdxXZ4oUwbqjyHYt5g2/GqCxiWSTtFz9fa54uikcB71ROHilm5b6tZNwVwzB5T1JeCcIDjpHh2ArXzOXBmjzdMrVDppZH4km3ftDOsTtpZ6NriYwu6dMToVt92uL0k8PzL6rtK75Xk1TPpOmBU/PC/viFIq5IXI8yDJknUdvbrXyVxfhjl4FARm1l99rky2OhD+XSFsMU26zEMGNeHSUnuTeZGK6Y+W0ixye0/TtMuy/072Jb4LDz5/AwxnWkw/obeXnh+vGVD59+sKrPZL5PHkzFUiJ2N8Pb+X/YLb8BMNPP1jIH8FcAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;websocket协议与http协议的关系&quot;
        title=&quot;&quot;
        src=&quot;/static/07e7ff97417a607f47c3012b032b39a5/40fad/http_websocket.png&quot;
        srcset=&quot;/static/07e7ff97417a607f47c3012b032b39a5/707e9/http_websocket.png 148w,
/static/07e7ff97417a607f47c3012b032b39a5/649e0/http_websocket.png 295w,
/static/07e7ff97417a607f47c3012b032b39a5/40fad/http_websocket.png 590w,
/static/07e7ff97417a607f47c3012b032b39a5/b3fef/http_websocket.png 885w,
/static/07e7ff97417a607f47c3012b032b39a5/301c0/http_websocket.png 1180w,
/static/07e7ff97417a607f47c3012b032b39a5/b5a53/http_websocket.png 1770w,
/static/07e7ff97417a607f47c3012b032b39a5/7d191/http_websocket.png 2196w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图1 WebSocket协议与http协议的关系&lt;/div&gt;
&lt;h2&gt;建立WebSocket通信&lt;/h2&gt;
&lt;h3&gt;客户端&lt;/h3&gt;
&lt;p&gt;　　HTML5将WebSocket协议标准化，目前各大主流浏览器均已支持WebSocket协议。浏览器提供了一个&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/WebSocket&quot;&gt;WebSocket对象&lt;/a&gt;用来创建和管理WebSocket连接。客户端可以利用这一对象与服务器进行WebSocket通信。一个简单的客户端建立WebSocket通信的代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Create WebSocket connection.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; socket &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;WebSocket&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ws://localhost:3000&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Connection opened&lt;/span&gt;
socket&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;open&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;websocket协议握手成功！！！&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Listen for messages&lt;/span&gt;
socket&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;message&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;收到新消息！！！&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Connection closed&lt;/span&gt;
socket&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;close&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;停止websocket协议！！！&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;服务端&lt;/h3&gt;
&lt;p&gt;　　目前，针对不同的服务器环境均有对应的WebSocket框架可以使用，详情可见&lt;a href=&quot;https://en.wikipedia.org/wiki/Comparison_of_WebSocket_implementations&quot;&gt;维基百科&lt;/a&gt;。适用于Node环境的WebSocket框架主要有以下几类：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://github.com/websockets/ws&quot;&gt;ws&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://github.com/uNetworking/uWebSockets&quot;&gt;uWebSockets&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://socket.io/&quot;&gt;socket.io&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;　　以Node环境下的&lt;strong&gt;&lt;a href=&quot;https://github.com/websockets/ws&quot;&gt;ws&lt;/a&gt;&lt;/strong&gt;框架为例，一个简单的服务器端实现WebSocket协议的示例代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// import http module&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; http &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;http&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// import ws&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; websocket &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ws&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// create http server&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; server &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// create websocket instance&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; websocketServer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;websocket&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Server&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;server&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// listen for connection&lt;/span&gt;
websocketServer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;connection&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ws&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// listen for messages&lt;/span&gt;
    ws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;message&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msg&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;收到了新消息！！！&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        ws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;您好，我已经收到了你的消息&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;WebSocket协议握手&lt;/h3&gt;
&lt;p&gt;　　WebSocket协议使用了http协议的握手通道，由http协议升级到WebSocket协议时的http报文示例如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;request&lt;/strong&gt;&lt;/p&gt;
&lt;div style=&quot;text-align: center&quot;&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/24802716c8898a405bcca37a58137c73/175e8/websocket_request.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 41.37404580152672%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABSUlEQVQoz51Sa4+CQAzk//+2C4JCQEUPUFAeu7DAISo41zbxw325S26TSZt9TKfTtbIsw2azgeu6iOMYRVHicDwiv1zR9wOmacLj8cD9fpf4er1+hWWMwXq9hkekQRAiSc9QuoHpOnR9L6TjOEq83Sb8tSylNTzPI1Wf2O4PRHjC6ZyhqmtcSe3lWkApjaKsJGflZVWjImT5Becsl8hnfN9qW4PtLkKcpPD8AB+2Iyr5IZMwqlpJgZLymvKmaQXvIgzOubCllKJWA1KVE+kJKakbx5vgP8vS1LJt2/B9H2G4JdKEFKZCfowTxGQBt9IPg3jLyliJpjjPs5D8GMqbcLVawXFcan8nHvFAjOkETMaXn0TwfM5EtGBZFtnj+IYQNk1DRA72UYSQvOShsF/sIUf2jBVqUjcMX2jpV3ARLspn/Bt4DqyebfoGeZldNc/eyYgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;websocket协议握手时http请求报文&quot;
        title=&quot;&quot;
        src=&quot;/static/24802716c8898a405bcca37a58137c73/40fad/websocket_request.png&quot;
        srcset=&quot;/static/24802716c8898a405bcca37a58137c73/707e9/websocket_request.png 148w,
/static/24802716c8898a405bcca37a58137c73/649e0/websocket_request.png 295w,
/static/24802716c8898a405bcca37a58137c73/40fad/websocket_request.png 590w,
/static/24802716c8898a405bcca37a58137c73/b3fef/websocket_request.png 885w,
/static/24802716c8898a405bcca37a58137c73/301c0/websocket_request.png 1180w,
/static/24802716c8898a405bcca37a58137c73/175e8/websocket_request.png 1310w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;response&lt;/strong&gt;&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3d53dbe030b0a0caf79ad3f2b72d4cf1/08646/websocket_response.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 11.094224924012158%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsSAAALEgHS3X78AAAAYElEQVQI13WMMQ6AIBAE+f8DEVQK7IgcUEAiBFiFWOokk612mDEGnHNIKbErBec9rLXwPqCUgitn5NdaK3rvaK3N/ZKllGZwEQJy3aD1gRjTEw4zSuRAzuG0NKODcfzjBj6/mbvFnF1JAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;websocket协议握手时http响应报文&quot;
        title=&quot;&quot;
        src=&quot;/static/3d53dbe030b0a0caf79ad3f2b72d4cf1/40fad/websocket_response.png&quot;
        srcset=&quot;/static/3d53dbe030b0a0caf79ad3f2b72d4cf1/707e9/websocket_response.png 148w,
/static/3d53dbe030b0a0caf79ad3f2b72d4cf1/649e0/websocket_response.png 295w,
/static/3d53dbe030b0a0caf79ad3f2b72d4cf1/40fad/websocket_response.png 590w,
/static/3d53dbe030b0a0caf79ad3f2b72d4cf1/b3fef/websocket_response.png 885w,
/static/3d53dbe030b0a0caf79ad3f2b72d4cf1/301c0/websocket_response.png 1180w,
/static/3d53dbe030b0a0caf79ad3f2b72d4cf1/08646/websocket_response.png 1316w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;　　上述http报文中与WebSocket协议握手阶段相关的字段解释如下：&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;表1 WebSocket协议握手阶段http报文首部相关字段解释&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;字段名称&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;含义&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Connection: Upgrade&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;表示要升级协议。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Upgrade:websocket&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;表示要升级到WebSocket协议。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Sec-WebSocket-Extensions&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;仅用在WebSocket连接握手阶段。它先由客户端(浏览器)发送到服务器，然后再由服务器传回客户端，以便协商连接过程中的协议层扩展集。可能在HTTP请求中出现多次(等价于出现一次，但有多个值)，但是最多只能在HTTP响应中出现一次。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Sec-WebSocket-Key&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;Base64编码字符串，与服务端响应首部的Sec-WebSocket-Accept是配套的，提供基本的防护，比如恶意的连接，或者无意的连接。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Sec-WebSocket-Version&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;表示websocket的版本。如果服务端不支持该版本，需要返回一个Sec-WebSocket-Version首部字段，里面包含服务端支持的版本号。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Sec-WebSocket-Accept&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;Base64编码字符串，根据客户端请求首部的Sec-WebSocket-Key计算出来。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;　　Sec-WebSocket-Accept字段计算公式：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;将Sec-WebSocket-Key跟258EAFA5-E914-47DA-95CA-C5AB0DC85B11拼接。&lt;/li&gt;
&lt;li&gt;通过SHA1计算出摘要，并转成base64字符串。伪代码：toBase64(sha1(Sec-WebSocket-Key + 258EAFA5-E914-47DA-95CA-C5AB0DC85B11))。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;参考文献&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;http://www.ruanyifeng.com/blog/2017/05/websocket.html&quot;&gt;WebSocket 教程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.zhihu.com/question/20215561&quot;&gt;知乎：WebSocket 是什么原理？为什么可以实现持久连接？&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/rKvoevbSmtAUoCgOH2lZdQ&quot;&gt;WebSocket：5分钟从入门到精通&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/tennysonsky/article/details/44562435&quot;&gt;如何理解HTTP协议的 “无连接，无状态” 特点？&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.lyz810.com/article/2016/06/websocket-handshake-server-response/&quot;&gt;WebSocket协议详解及应用(三)-WebSocket握手协议之服务器响应&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[为什么setTimeout和setInterval的实际延时比设置的时间长]]></title><description><![CDATA[点击查看英文原文 延时比设置的时间长的原因 　　 setTimeout / setInterval 延时超出预期时间是由多种原因造成的。常见的原因归结如下： 限制延时不得低于4ms 　　在现代浏览器中，当回调函数嵌套达到一定级别或者在触发一定数量的setInterval…]]></description><link>https://blog.yanfangyao.guru//translate/20180202205143/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//translate/20180202205143/</guid><pubDate>Fri, 02 Feb 2018 20:51:43 GMT</pubDate><content:encoded>&lt;br&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout#Reasons_for_delays_longer_than_specified&quot;&gt;&lt;strong&gt;点击查看英文原文&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;延时比设置的时间长的原因&lt;/h2&gt;
&lt;p&gt;　　&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout&quot;&gt;setTimeout&lt;/a&gt;/&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setInterval&quot;&gt;setInterval&lt;/a&gt;延时超出预期时间是由多种原因造成的。常见的原因归结如下：&lt;/p&gt;
&lt;h3&gt;限制延时不得低于4ms&lt;/h3&gt;
&lt;p&gt;　　在现代浏览器中，当回调函数嵌套达到一定级别或者在触发一定数量的setInterval之后，浏览器会限制setTimeout/setInterval回调函数的调用周期不得小于4ms。下面的示例代码会触发浏览器的限制动作：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cb&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cb&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cb&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;setInterval&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;f&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　在Chrome和Firefox中，从第5次连续回调开始限制回调周期；Safari从第6次连续回调开始限制；Edge在第三次连续调用时开始限制。Gecko从&lt;a href=&quot;https://developer.mozilla.org/en-US/Firefox/Releases/56&quot;&gt;版本 56&lt;/a&gt;开始对setInterval调用采取与上述限制策略（它已经像这样处理setTimeout调用）。&lt;br&gt;
　　浏览器触发限制行为的条件了略有差异，比如Firefox只要检测到setInterval调用就会触发限制行为而不是必须等到setInterval被调用一定次数。&lt;/p&gt;
&lt;h3&gt;非活动标签页中的延时被限制不得低于1000ms&lt;/h3&gt;
&lt;p&gt;　　浏览器为了减小后台标签页中的加载量（同时减小电池消耗），限制后台标签页setTimeout/setInterval回调函数触发频率每秒不超过一次。&lt;br&gt;
　　Firefox从版本 5（详见&lt;a href=&quot;https://bugzilla.mozilla.org/show_bug.cgi?id=633421&quot;&gt;bug 633421&lt;/a&gt;，通过dom.min&lt;em&gt;background&lt;/em&gt;timeout&lt;em&gt;value可以修改1000ms这一常量）开始执行这一限制行为，Chrome从版本 11开始执行该行为。&lt;br&gt;
　　在适用于安卓的Firefox浏览器中，从Firefox 14的[bug 736602](&lt;a href=&quot;https://bugzilla.mozilla.org/show&quot;&gt;https://bugzilla.mozilla.org/show&lt;/a&gt;&lt;/em&gt;bug.cgi?id=736602)开始，后台标签页的setTimeout/setInterval触发间隔被设置为15分钟，并且后台标签可以被完全卸载。&lt;br&gt;
　　&lt;strong&gt;注：当后台标签页使用Web Audio API &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/AudioContext&quot;&gt;AudioContext&lt;/a&gt;播放音频时，Firefox 50不对后台标签页进行限制。从Firefox 51开始，一旦后台标签页中出现了&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/AudioContext&quot;&gt;AudioContext&lt;/a&gt;，即使页面没有播放音频，Firefox也不限制该页面。&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;对追踪脚本的延时限制&lt;/h3&gt;
&lt;p&gt;　　从Firefox 55开始，追踪脚本（比如Google Analytics，任何Firefox通过其TP表识别的脚本URL）受到了进一步的限制。追踪脚本在前台页面运行时，其最小时间间隔仍然设置为4ms。但是当追踪脚本在后台标签页运行时，其最小延时被限制为10s，这将在文档首次加载之后30s生效。&lt;br&gt;
　　控制这一限制行为的字段如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;dom.min&lt;em&gt;tracking&lt;/em&gt;timeout_value: 4&lt;/li&gt;
&lt;li&gt;dom.min&lt;em&gt;tracking&lt;/em&gt;background&lt;em&gt;timeout&lt;/em&gt;value: 10000&lt;/li&gt;
&lt;li&gt;dom.timeout.tracking&lt;em&gt;throttling&lt;/em&gt;delay: 30000&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;晚延时&lt;/h3&gt;
&lt;p&gt;　　除了浏览器的限制策略之外，当页面（或者操作系统/浏览器本身）忙于其他任务时，setTimeout/setInterval回调函数也会比预设的时间晚触发。值得关注的一点是，setTimeout/setInterval回调函数或者代码片段不能被执行直到调用setTimeout()的主线程结束。比如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;foo has been called&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;After setTimeout&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　要写入控制台的结果：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;After setTimeout
foo has been called&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　这是因为即使setTimeout被调用时延时设置为0，它也会被放置在一个执行队列中并且计划在下一个时机被执行而不是立即被执行。当前正在被执行的代码必须在执行队列中的任务被执行前执行完成，因此最终的执行顺序可能不符合预期。&lt;br&gt;
　　为了在现代浏览器中实现0ms延时，可以参考&lt;a href=&quot;https://dbaron.org/log/20100309-faster-timeouts&quot;&gt;这篇文章&lt;/a&gt;介绍的使用&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage&quot;&gt;postMessage()&lt;/a&gt;的方案。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[解决webpack中使用ejs-loader时模板嵌套的问题]]></title><description><![CDATA[问题背景 　　笔者在项目开发中使用 webpack 构建前端静态资源，项目中用到了ejs模板并使用 ejs-loader 进行解析。当笔者使用ejs的 include语法 在一个ejs模板中引入另一个ejs模板时，webpack一直构建失败。 问题产生原因 　　笔者在ejs…]]></description><link>https://blog.yanfangyao.guru//tips/20180125192502/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//tips/20180125192502/</guid><pubDate>Thu, 25 Jan 2018 19:25:02 GMT</pubDate><content:encoded>&lt;h2&gt;问题背景&lt;/h2&gt;
&lt;p&gt;　　笔者在项目开发中使用&lt;a href=&quot;https://doc.webpack-china.org/&quot;&gt;webpack&lt;/a&gt;构建前端静态资源，项目中用到了ejs模板并使用&lt;a href=&quot;https://github.com/okonet/ejs-loader&quot;&gt;ejs-loader&lt;/a&gt;进行解析。当笔者使用ejs的&lt;a href=&quot;http://ejs.co/#docs&quot;&gt;include语法&lt;/a&gt;在一个ejs模板中引入另一个ejs模板时，webpack一直构建失败。&lt;/p&gt;
&lt;h2&gt;问题产生原因&lt;/h2&gt;
&lt;p&gt;　　笔者在ejs-loader的&lt;a href=&quot;https://github.com/okonet/ejs-loader/blob/master/README.md&quot;&gt;README文档&lt;/a&gt;中找到了原因：ejs-loader使用&lt;a href=&quot;https://lodash.com/docs/4.17.4#template&quot;&gt;lodash库中的template函数&lt;/a&gt;编译ejs模板而不是使用标准的ejs模板引擎。由于&lt;a href=&quot;https://lodash.com/docs/4.17.4#template&quot;&gt;lodash库中的template函数&lt;/a&gt;无法识别ejs的include方法，所以按照笔者的方式进行ejs模板的嵌套不成功。&lt;/p&gt;
&lt;h2&gt;问题解决方案&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;在使用ejs-loader的情况下，以参数的形式将ejs-loader编译后生成的子模板函数传入到父模板函数中，然后在父ejs模板中需要嵌套子模板的地方以&amp;#x3C;%= childTemplateFunction(data) %&gt;的形式引用子模板函数，这样就可以实现ejs模板的嵌套。示例代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; parent &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./parent.ejs&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; child &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./child.ejs&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; renderHTML &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;parent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
child
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;parent.ejs:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&amp;lt;%= child({name: &apos;test&apos;}) %&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;child.ejs:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&amp;lt;%= name %&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;renderHTML:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;test&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;使用&lt;a href=&quot;https://github.com/bazilio91/ejs-compiled-loader&quot;&gt;ejs-compiled-loader&lt;/a&gt;替换ejs-loader。&lt;a href=&quot;https://github.com/bazilio91/ejs-compiled-loader&quot;&gt;ejs-compiled-loader&lt;/a&gt;使用ejs引擎编译ejs模板，支持ejs的include语法。&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[图片等比例缩放]]></title><description><![CDATA[前言 　　前端工程师开发的网站是直接与用户打交道的，网页用户体验的好坏也直接或间接地体现了一个前端工程师水平的高低。特别是对于Ｃ端（用户端）网页的开发，用户体验至关重要。 
　　目前，根据终端设备的不同，大体可将网站开发分为PC站和移动端H5页面两种。近些年来由于 HTML…]]></description><link>https://blog.yanfangyao.guru//image/20171105132655/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//image/20171105132655/</guid><pubDate>Sun, 05 Nov 2017 13:26:55 GMT</pubDate><content:encoded>&lt;h2&gt;前言&lt;/h2&gt;
&lt;p&gt;　　前端工程师开发的网站是直接与用户打交道的，网页用户体验的好坏也直接或间接地体现了一个前端工程师水平的高低。特别是对于Ｃ端（用户端）网页的开发，用户体验至关重要。&lt;br&gt;
　　目前，根据终端设备的不同，大体可将网站开发分为PC站和移动端H5页面两种。近些年来由于&lt;a href=&quot;https://www.w3.org/TR/2016/REC-html51-20161101/&quot;&gt;HTML5标准&lt;/a&gt;的普及以及移动端H5开发周期端的优点，不少app中都嵌入了相应了H5页面。前端技术的普及和流行促使前端工程师开发出用户体验更好、性能更优的网页。&lt;/p&gt;
&lt;h2&gt;图片适配不同终端设备&lt;/h2&gt;
&lt;p&gt;　　目前终端设备的屏幕尺寸和分辨率纷纷杂杂，对于同一尺寸的图片而言，它在某些宽屏设备上可能显示的非常完美，但是在某些窄屏手机上会显示不全。为了让网页具备更好的用户体验，从而吸引更多的用户资源，网页图片的展示需要自适应不同尺寸的终端设备。&lt;br&gt;
　　为了解决图片的适配问题，最常用也是笔者认为最合适的解决方案就是&lt;font color=#FF8800&gt;图片的等比例缩放&lt;/font&gt;。 &lt;/p&gt;
&lt;h2&gt;图片等比例缩放&lt;/h2&gt;
&lt;p&gt;　　图片等比例缩放，顾名思义，就是图片的宽高以固定的比值变化。图片宽高比值的确定一般有两种方式：1、不管图片原始尺寸的大小，统一将图片压缩、裁剪至所需要的比例。2、保留图片原始宽高比进行缩放。&lt;br&gt;
　　第一种方法一般借助于图床来对图片进行压缩和裁剪，有些图床可以支持在图片url中加上尺寸后缀来获得对应尺寸的图片。第二种方法也可以借用图床来实现，有些图床支持在图片url上只加上宽或高的尺寸后缀来获得按照图片原始比例压缩、裁剪后的图片。如果前端项目中涉及的图片较少，则无需借助于图床功能，可以利用CSS设置img标签的宽度或者高度（&lt;font color=#FF8800&gt;只设置一个属性&lt;/font&gt;），浏览器会根据图片自身的宽高比来计算img标签的另外一个属性的值，由此就可以实现保留图片原始宽高比进行缩放。&lt;/p&gt;
&lt;h2&gt;图片等比例缩放的优化实现&lt;/h2&gt;
&lt;p&gt;　　浏览器将图片当做独立的文件单独加载，如果只是借助于img标签按照上述方法来实现图片的等比例缩放，会导致&lt;font color=#FF0000&gt;浏览器下载解析完一张图片后重新调整页面的布局，造成页面不规律的移动，极大损害用户体验&lt;/font&gt;。可以采用如下方法来优化图片等比例缩放的实现。&lt;br&gt;
　　&lt;font color=#6AC54D&gt;为img标签添加一个父元素，设置父元素具有和图片相同的宽高比，然后设置img标签的width属性值为100%或者height属性值为100%，以保证图片刚好充满整个父元素空间&lt;/font&gt;。设置图片具有和图片相同的宽高比的目的是在图片被下载和解析完之前，父元素充当页面占位符的作用，防止浏览器重新布局导致的页面波动。&lt;br&gt;
　　如何让img标签父元素表现出特定的宽高比？可以通过设置父元素的padding值来实现。&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/CSS/padding&quot;&gt;查阅MDN文档&lt;/a&gt;可以发现，&lt;font color=#FF8800&gt;当元素的padding值为百分比值时，其参照值是元素包含块的width值&lt;/font&gt;。在img标签父元素包含块的宽度已经根据不同终端设备上的适配需求设定好的前提下，可以通过设置父元素的width值为100%，padding-bottom或者padding-top值为所要实现的宽高比（百分数形式），并且height等于0来实现img标签父元素width值和真实高度（包含padding-top或者padding-bottom值）具有固定比值的目的。虽然父元素的height值为0，但是其子元素可以溢出父元素height部分并且充满padding部分，其视觉效果与父元素height值与with值呈特定比例时一致。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[JavaScript基础（二）]]></title><description><![CDATA[JS数据类型 　　ECMAScript 5（ES 5）规定了5种简单（基本）数据类型： undefined、null、boolean、number、string 以及1种复杂数据类型： object 。ECMAScript 6（ES 6）增加了1个基本数据类型： symbol…]]></description><link>https://blog.yanfangyao.guru//javascript/20170829011122/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//javascript/20170829011122/</guid><pubDate>Tue, 29 Aug 2017 01:11:22 GMT</pubDate><content:encoded>&lt;h2&gt;JS数据类型&lt;/h2&gt;
&lt;p&gt;　　ECMAScript 5（ES 5）规定了5种简单（基本）数据类型：&lt;font color=#6AC54D&gt;undefined、null、boolean、number、string&lt;/font&gt;以及1种复杂数据类型：&lt;font color=#6AC54D&gt;object&lt;/font&gt;。ECMAScript 6（ES 6）增加了1个基本数据类型：&lt;font color=#6AC54D&gt;symbol&lt;/font&gt;。使用&lt;em&gt;typeof&lt;/em&gt;可以检测变量值的类型（值得注意的是JS中的变量没有类型），&lt;em&gt;typeof&lt;/em&gt;可以返回的结果有7种：&lt;font color=#FF8800&gt;“undefined”、“object”、“boolean”、
“number”、“string”、“function”、“symbol”&lt;/font&gt;。&lt;br&gt;
　　上述7种&lt;em&gt;typeof&lt;/em&gt;返回的结果中，只有 “function” 找不到与之对应的基本数据类型。function其实是object的一个子类型。具体来说，function是可以被调用的对象，它有一个内部属性 “call”，使其可以被调用。另外，JS中的array类型也是object的子类型，只不过array是按照数值顺序来进行元素的索引，普通object是通过字符串键值来索引。在ES 5中，&lt;em&gt;typeof&lt;/em&gt;对没有定义的变量（&lt;em&gt;typeof&lt;/em&gt;不会报出 “Uncaught ReferenceError” 错误）或者已被定义但是没有初始化的变量返回的结果均是 “undefined”，因此可以用来检测变量是否已被定义或者初始化。&lt;font color=#FF0000&gt;但是ES 6引入了let命令，它会形成&lt;a href=&quot;http://es6.ruanyifeng.com/#docs/let&quot;&gt;&lt;em&gt;temporal dead zone&lt;/em&gt;（暂时性死区）&lt;/a&gt;，&lt;em&gt;typeof&lt;/em&gt;在let命令声明变量之前使用变量会报出 “Uncaught ReferenceError” 错误&lt;/font&gt;。&lt;/p&gt;
&lt;h2&gt;JS变量&lt;/h2&gt;
&lt;p&gt;　　按照第１节的介绍，JS变量存储的值可以分为两种类型：基本类型和引用类型(复杂类型)。基本类型对应于6种基本数据类型（undefined、null、boolean、number、string、symbol）。引用类型对应于JS中的对象（object）。基本类型和引用类型各自的特点如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;em&gt;基本类型的值占用固定大小的内存空间，其被分配在栈空间中；引用类型的值是对象，其占用的存储空间大小可以动态改变，其被分配在堆空间中&lt;/em&gt;。&lt;/li&gt;
&lt;li&gt;&lt;em&gt;引用类型是一种数据结构，它将数据和功能组织在一起。存储引用类型的变量实际上存储的是指向对象的指针。&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;复制基本类型的值，会创建这个值的副本；复制引用类型的值，会创建指向对象的指针的副本；JS中所有函数的参数传递都是按值传递的。&lt;/em&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;JS作用域&amp;#x26;作用域链&lt;/h2&gt;
&lt;p&gt;　　JS变量是有其对应的作用域（或者执行环境）的。作用域决定了变量的生命周期以及哪一部分代码可以访问相应的变量。JS中的作用域有全局和局部之分，全局作用域是最外围的一个执行环境，如window，每定义一个函数就定义了一个局部作用域(函数作用域)；ES 6中的let命令引入了另外一种局部作用域，块级作用域(”{ }“形成的作用域)。每个作用域都有一个与之关联的变量对象，该对象保存了该作用域中定义的所有变量和函数。&lt;br&gt;
　　当JS代码在某个作用域中执行时，会创建变量对象的一个作用域链，这个作用域链可以保证对执行环境有权访问的所有变量和函数的有序访问。作用域链的起始是当前作用域，下一个是当前环境的包含环境（父作用域），依此类推直到全局作用域，由此形成了一个作用域链。作用域链的概念可由图1来刻画。&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6373162c604708e49589a5e7b278a981/b197e/js_scope.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 311px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 111.89710610932475%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAACOElEQVQ4y42VW2/aQBCF/f//Rx/6UimvVdpIbSMkqpRIrVKSkkICDmB8v1/369hA6oC5rBgtoPHZc+bMjjUjXYJxBw8XMLmC4QfQ+5iZSVWVoJR8VLM3q/29Y2l69ETgPeJZP/HdP4QSnjNkEesI1Bpjm30E6BUwKSKCMiRWOQth2zevSVVJVqaoqkKZJsqyUEFwHsPdP8xkzkqipIJCAL/3Ube3qJubNdNNCRTdoJraJmxrJSsW1st4RlQEew+oE7K1dlIbNCpCRv4QK7OIqoRAwOsy7OYdlNxO8jKnke6HMxz3Ad8b4YXPwlo/H7DN1MkdingFz99g/Anu3sOs17SSUtVR6Z2AYe4zj56xkgVmumIaPGLH8z2G7VIdBaxXXuVkVUZZFfyQVpoEo728LlCty8UuMXUrjf375qA6p9pIP4vhriRfTLJE+iya8CI3qy6DIQcYycseU+1QP7WTajPKaAFPX+DvR/j1Tij/ZpUawrQ8LrmLsS2AfrIkkTaKQp00mJKldmPSrqqzAGtj3MzGzT0Jl6/LS6Yiv9ywa+drp6ZHV7/VA2UiBhlyPZWMuFKMquNsyW2TancdMcXMLe6jEUZuY5a+hNeYpHWgvB1Tm9iCF9KbptxvgsV6IE+vZf8sew89HB8A7AD9X8+ceaITOw+E0ysiY0A475HM+00ZtCN63/7czsJNX7qFj6dSvCqSSNYhxmlHgQYDuLyEC3nf9HqvoCfn4UHJ9dh3XWniFcq29wzqin+QpLokYp00xQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;作用域链&quot;
        title=&quot;&quot;
        src=&quot;/static/6373162c604708e49589a5e7b278a981/b197e/js_scope.png&quot;
        srcset=&quot;/static/6373162c604708e49589a5e7b278a981/e962e/js_scope.png 148w,
/static/6373162c604708e49589a5e7b278a981/afbb0/js_scope.png 295w,
/static/6373162c604708e49589a5e7b278a981/b197e/js_scope.png 311w&quot;
        sizes=&quot;(max-width: 311px) 100vw, 311px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 1 JavaScript作用域链&lt;/div&gt;
　　在作用域链中，子作用域（执行环境）中的代码可以访问其父作用域中的变量或函数，但是父作用域中的代码不能访问子作用域中的变量或函数。&lt;font color=#6AC54D&gt;标志符的解析是沿作用域链从当前作用域向上一级一级地解析，直到解析到全局环境，如果在全局环境还是没有找到标志符的定义，则JS代码会报出&quot;Uncaught ReferenceError&quot;错误&lt;/font&gt;。
&lt;h2&gt;JS的垃圾收集策略 ##s&lt;/h2&gt;
&lt;p&gt;　　JS是一门具有内存自动分配和回收机制的语言，开发人员无法进行内存的分配和回收。垃圾回收制度深刻影响着JS的性能。&lt;br&gt;
　　目前JS的垃圾搜集算法主要有两种：&lt;font color=#6AC54D&gt;标记清除和引用计数&lt;/font&gt;。标记清除算法是将当前不使用的值加上标记然后回收其内存，如当某个变量离开了当前环境则将其值标记为可以回收。引用计数算法是用来记录每个值被引用的次数，当次数为0时表示该值所占用的内存空间可以回收。&lt;font color=#FF0000&gt;引用计数算法会陷入循环引用的问题&lt;/font&gt;，如变量a和b互相引用，导致变量a和b所占据的内存均无法回收，消耗系统资源，严重时可极大降低系统性能。&lt;/p&gt;
&lt;h2&gt;优化内存管理&lt;/h2&gt;
&lt;p&gt;　　尽管JS是自动实现内存的分配与回收，开发人员仍然可以通过养成良好的编码习惯来优化内存管理。&lt;font color=#6AC54D&gt;对于不再使用的引用类型，开发人员可以手动将其赋值为null，这样做不仅便于JS的垃圾搜集，而且还可以避免循环引用的问题&lt;/font&gt;。&lt;/p&gt;
&lt;h2&gt;创建对象的几种方式&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;new + constructor（构造函数）&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;对象字面量&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;根据给定的原型和属性(可选)来构建对象，Object.create(proto[, propertiesObject])&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 构造对象的原型为null&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 同对象字面量&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prototype&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 构造一个原型为fn，包含属性add的对象&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; fn &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;add&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;定义函数的几种方式&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;通过函数声明的方式定义&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;arg1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; arg2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; arg1 &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; arg2&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;通过函数表达式定义&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;example&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;arg1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; arg2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; arg1 &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; arg2&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用构造函数&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; example &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;arg1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;arg2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;return arg1 + arg2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;函数声明与函数表达式&lt;/h2&gt;
&lt;p&gt;　　JS解析器会率先读取函数声明，并使函数在执行任何代码之前可以被访问，函数表达式必须等到解析器执行到它所在的代码时才会被执行。这就是函数声明提升的概念。&lt;/p&gt;
&lt;h2&gt;函数内部对象&lt;/h2&gt;
&lt;p&gt;　　函数内部存在两个特殊的对象：&lt;em&gt;arguments&lt;/em&gt;和&lt;em&gt;this&lt;/em&gt;。&lt;em&gt;arguments&lt;/em&gt;是一个类数组，包含着传入函数中的所有参数，它有一个属性&lt;em&gt;callee&lt;/em&gt;，该属性指向拥有这个&lt;em&gt;arguments&lt;/em&gt;对象的函数。&lt;em&gt;this&lt;/em&gt;引用的是函数据以执行的环境对象。&lt;/p&gt;
&lt;h2&gt;函数的属性&lt;/h2&gt;
&lt;p&gt;　　JS中的函数均包含两个属性：&lt;em&gt;length&lt;/em&gt;和&lt;em&gt;prototype&lt;/em&gt;。&lt;em&gt;length&lt;/em&gt;属性表示的是函数接受参数的个数；&lt;em&gt;prototype&lt;/em&gt;属性用来保存由构造函数构造的所有对象实例的方法。&lt;/p&gt;
&lt;h2&gt;如何鉴别数组&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;(arr instanceof Array) === true;&lt;/li&gt;
&lt;li&gt;Array.isArray(arr) === true;&lt;/li&gt;
&lt;li&gt;Object.prototype.toString.call(arr) === ’[Object Array]’&lt;/li&gt;
&lt;li&gt;Object.prototype.toString.apply(arr) === ’[Object Array]’&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[JavaScript基础（一）]]></title><description><![CDATA[JavaScript语言的组成 　　JavaScript语言（以下简称“JS”）包含的内容可以由图1来概括： 　　 ECMAScript 由 ECMA-262标准 定义，规定了语言核心功能。JS实现了 ECMAScript…]]></description><link>https://blog.yanfangyao.guru//javascript/20170829010341/</link><guid isPermaLink="false">https://blog.yanfangyao.guru//javascript/20170829010341/</guid><pubDate>Tue, 29 Aug 2017 01:03:41 GMT</pubDate><content:encoded>&lt;h2&gt;JavaScript语言的组成&lt;/h2&gt;
&lt;p&gt;　　JavaScript语言（以下简称“JS”）包含的内容可以由图1来概括：&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/235a4c4da533ec4a69df55ec621b2263/3962e/js_composition.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 462px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.493506493506494%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABhUlEQVQoz5VTDU+DMBT0//8rNYsxizqdiozhNpzGbZTv9YNCz0cBZcsSteTC4/XdcX1tz3A0jDH46zhVe3aqoHmrsoSUCqKD7NDESpUHtb8K7rlEGKUkqiEbKE1CpUWpK7A4Q7EX/xEU1snd/RS3kwecX45wMbrC+GaCq+sxojgBF+qb0zwHgjbZoRlFwclFitdlgPliBddfYrF8JwRwPR+M3OdUc9wmK2jaL/uPPqlqgyQtaKnUR3Ky/1zhI3SQCmlzSZbbHrdKPa8T7MUw7EWeAnEI7D5hWAiTJ1DZBLlaIxRbMLkhbJHpmLg1enqj1DqsKlRshzAIsJl7YK6DeP2GKmI0R050iGTjYxc8wPA3ayZREZyPJ3hrDxHfQdflYMlkXxPZ9xd4nD7BnXmYeXMoRoJqT9hgFazguDMSfCfBCrlOsSQDzy8zxJyhrNXhpoATUTRkOg6St7HgbW91QU4jChKYMrZEWQnwmvoMDk7zP5vS71KHehAPT5idM0c35KioyX8B36RXfPhAVR8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;js的组成&quot;
        title=&quot;&quot;
        src=&quot;/static/235a4c4da533ec4a69df55ec621b2263/3962e/js_composition.png&quot;
        srcset=&quot;/static/235a4c4da533ec4a69df55ec621b2263/98ba0/js_composition.png 148w,
/static/235a4c4da533ec4a69df55ec621b2263/f1d4f/js_composition.png 295w,
/static/235a4c4da533ec4a69df55ec621b2263/3962e/js_composition.png 462w&quot;
        sizes=&quot;(max-width: 462px) 100vw, 462px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;div style=&quot;text-align: center;&quot;&gt;图 1 JavaScript语言的组成&lt;/div&gt;
&lt;p&gt;　　&lt;em&gt;ECMAScript&lt;/em&gt;由&lt;a href=&quot;https://www.ecma-international.org/publications/standards/Ecma-262.htm&quot;&gt;ECMA-262标准&lt;/a&gt;定义，规定了语言核心功能。JS实现了&lt;em&gt;ECMAScript&lt;/em&gt;规定的核心语言功能并对在此基础上进行了扩充。&lt;br&gt;
　　&lt;a href=&quot;https://www.w3.org/DOM/&quot;&gt;&lt;em&gt;DOM&lt;/em&gt;&lt;/a&gt;是文档对象模型，提供了一系列API可供JS来操控HTML页面元素。&lt;em&gt;DOM&lt;/em&gt;把整个页面映射成一个具有多层节点的树结构，可以方便JS开发人员对页面节点进行增、删、查、改等一系列操作。然而&lt;em&gt;DOM&lt;/em&gt;并不是JS私有的，JS只是实现了&lt;em&gt;DOM&lt;/em&gt;，其他语言也可以实现&lt;em&gt;DOM&lt;/em&gt;。&lt;br&gt;
　　&lt;em&gt;BOM&lt;/em&gt;是浏览器对象模型，提供了一系列API可供JS来操控Web浏览器。比如浏览器中window对象的一系列属性就可以用来控制浏览器的行为，完成像页面跳转、本地存储等操作。&lt;em&gt;BOM&lt;/em&gt;比较突出的问题就是不同浏览器之间的兼容性问题。&lt;a href=&quot;https://www.w3.org/TR/2016/REC-html51-20161101/&quot;&gt;HTML5标准&lt;/a&gt;的普及有望解决这一问题。&lt;br&gt;
　　JS的运行环境通常可以分为客户端环境和服务端环境两种。Web浏览器是JS运行的客户端环境，&lt;a href=&quot;https://nodejs.org/zh-cn/&quot;&gt;Node&lt;/a&gt;则是当前主流的JS服务端环境。&lt;/p&gt;
&lt;h2&gt;JS注入到页面中的方式&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;直接在HTML源码中嵌入JS代码&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;JS&lt;/span&gt;代码块&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;以外部文件的形式引入&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;{JS文件url}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　两种注入方式比较：在HTML源码中直接嵌入JS代码的方式使得页面结构（HTML）与页面的动作（JS）结合在一起，当需要更新JS代码时，HTML文件也需要更新，这样不利于项目代码的维护；以外部文件的形式引入JS代码文件，使得页面结构与动作分离，代码的可维护性强。于是，在实际项目开发中一般以外部文件的形式在HTML文件中引入JS代码。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;页面结构的优化&lt;/h2&gt;
&lt;p&gt;　　&lt;strong&gt;优化方向&lt;/strong&gt;：考虑到HTML页面是按照&lt;em&gt;DOM&lt;/em&gt;树从上到下依次加载的，并且JS代码也是顺序执行的，如果将script标签放在HTML页面的head标签中，则在加载、解析、执行完JS代码之前，浏览器不能开始加载和渲染页面内容，为了加快浏览器渲染出页面的速度，提高用户体验，可以&lt;font color=#6AC54D&gt;&lt;strong&gt;将script标签放在body标签中的最下方&lt;/strong&gt;&lt;/font&gt;；又考虑到项目的可维护性和可缓存性，&lt;font color=#6AC54D&gt;&lt;strong&gt;优先考虑以外部文件的形式在HTML中引入JS代码&lt;/strong&gt;&lt;/font&gt;。&lt;/p&gt;</content:encoded></item></channel></rss>