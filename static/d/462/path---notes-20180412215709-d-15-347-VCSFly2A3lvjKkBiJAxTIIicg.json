{"data":{"site":{"siteMetadata":{"title":"William's Blog","author":"William"}},"markdownRemark":{"id":"a623126e-e0ba-5586-a92e-469a3ea3756c","excerpt":"前言 　　了解浏览器的工作原理是一名前端开发工程师构的必修课。最近，笔者在工作之余，细心研读了以色列开发人员Tali Garsiel针对现代浏览器工作原理的 研究成果 以及 html5标准文档 等相关内容，并将自己的心得体会以学习笔记的形式记录下来。 现代浏览器的组成结构 　　现代浏览器的组成可由图1表示： 　　图…","html":"<h2>前言</h2>\n<p>　　了解浏览器的工作原理是一名前端开发工程师构的必修课。最近，笔者在工作之余，细心研读了以色列开发人员Tali Garsiel针对现代浏览器工作原理的<a href=\"https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/\">研究成果</a>以及<a href=\"https://www.w3.org/TR/html5/syntax.html\">html5标准文档</a>等相关内容，并将自己的心得体会以学习笔记的形式记录下来。</p>\n<h2>现代浏览器的组成结构</h2>\n<p>　　现代浏览器的组成可由图1表示：</p>\n<div style=\"text-align: center;\">\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5cfc2e36041f396281ff53391529a8b4/260bc/browser_components.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 450px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 67.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAADtElEQVQ4y12Sa2hbZRzGzwZC5xUv2E2mZkMUp6BuflC/+EGLyBCFybpPKu6DoJ9U1lEYfhjqWk3aLC10M66d13YromtssizZmpzcmiZNcpJzTtO0uZ80za3LPW1uj+9pOoT94eHP+39efjzvhSpZLG81WF+6wbGxBsvGmxwrkC5UPR6hyjCJstsldqEhzjse2cMltxhPoEDT3RSpllH+TZtVXW+u0v1UWTXzMQLLAOMBvAzg8wIeN9q0EaAN2Lx1EzCbiOft+KKID7sNBdXsgW2gadSL/CKaEbufSg+ek5QUw/1lhbxPVImoeH64r6qQn4pPTF6sjCpOV0bOb8+JTlfksq8y45flqfGJgcrAQFcHOGJC1CAC7dRfwL0W4LANeMVKNE/EEvmAl69FWx+R3EfueESHHcChX1a2XvqaxyPUThGgBQmzCHRShvVybwxAoAWs7PTFXBXufB2OTBmujRoC7f+9KOm61Q35xKTrGaUx23VBefW+zTm5pe3XohVZcFJ/REvHtGVgJtNsq7JtsWMymMOVSB5ToQ38uZolsxY6XgvqIvCbJ628MO37YEwVeHNsevHVys0hc8F1De0oAfbqXV3v0uyBtw1eSc+cV/IOzUmOs2nJ+961p781J46f8KUO9hh9kh7iHzWwB/fdsncP6iIv/G1M7r9z5BpJWGFUJCE5ctKZfCAdyH+XDZWGs8GiNBsqSnOhkmwjXJKG+du/5sJlGVlLRS9DVIiUpHZHqu+Hf4JPibA12Xu7SUJL0b2T0GNJPFtNAY0NoJkHNrNA3F9BIlBDjC8iypdQSAAt4m3lyAWS63HYUu5Px7nHRGDkdWqXmLDOqdESgTZNYO+8Nma26wTPgjZunNfEjVZ1xERkNavDjFkVNM1rYrT9etxARDv1CVbzb3RMrk8+KQL3UdSu7VcWTJ1X7tTZPW+cnJFQd9WpS9yhu2cnzuqee/EL4/7He/WPiutzR6jdBGhGnBaBC1QZocFMPTi0Vg3+nG8tfa73Bu5fEhr9nlBZZuFyY1ysNsQJzQ/3kiR+v/8MH4goueXwyNJy8Cee549t/0PzqAMpm/htGKqIJazXXSiCh1CzFjQM97yP3Jkr1MCcax3hArAQhOGzT44+KAgCIpEweI5DPn8bHoaxicA6rVA1udnG1qpZRXGlaY4rTjvZ/NUlvjw1fdmw0D1lqs4pZ6O+i6qwc0KbXL1irX//2sPUPVrtDZNOp/OR7tTr9StqtfpHEei49OVD7t/PPKGRntzzHxyNCv+kOv/WAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"现代浏览器组成\"\n        title=\"\"\n        src=\"/static/5cfc2e36041f396281ff53391529a8b4/260bc/browser_components.png\"\n        srcset=\"/static/5cfc2e36041f396281ff53391529a8b4/0c6a5/browser_components.png 148w,\n/static/5cfc2e36041f396281ff53391529a8b4/9f78f/browser_components.png 295w,\n/static/5cfc2e36041f396281ff53391529a8b4/260bc/browser_components.png 450w\"\n        sizes=\"(max-width: 450px) 100vw, 450px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n</div>\n<div style=\"text-align: center;\">图 1 现代浏览器的组成结构（图片摘自Tali Garsiel的研究成果）</div>\n<p>　　图1中包含的现代浏览器各组件的功能如下：<br>\n　　1. <strong>User Interface(用户界面)</strong>：浏览器的用户界面通常包含地址栏、前进/后退按钮以及书签栏等。除了用来展示用户请求的页面内容的窗口外，浏览器其他部分均属于用户界面。<br>\n　　2. <strong>Browser engine(浏览器引擎)</strong>：在用户界面和呈现引擎之间传送指令。<br>\n　　3. <strong>Rendering engine(呈现引擎)</strong>：呈现引擎的作用是呈现用户请求的web资源。如用户请求的资源是html文档，则呈现引擎负责解析html以及css，然后将渲染出的页面展示在浏览器窗口。<br>\n　　4. <strong>Networking(网络模块)</strong>：实现网络调用，如http请求。该模块提供了一个跨平台的通用接口。<br>\n　　5. <strong>UI backend(用户界面后端)</strong>：用户界面后端被用来绘制基本组件如组合框和窗口，其向外部暴露了一个跨平台的通用接口，它的底层使用了操作系统的用户界面方法。<br>\n　　6. <strong>JavaScript interpreter(JavaScript解释器)</strong>：用来解析和执行JavaScript。<br>\n　　7. <strong>Data storage(数据存储)</strong>：数据存储属于浏览器的持久层。浏览器可能需要在本地保存数据，如cookies，同时浏览器支持各种存储机制，如localStorage、IndexDB、WebSQL以及FileSystem。</p>\n<h2>浏览器的呈现引擎</h2>\n<p>　　呈现引擎默认可以解析html文档、xml文档以及图片等资源并将解析后的内容展示给用户。通过各种插件（浏览器扩展程序）浏览器还可以展示其他各类型的web资源，如pdf插件可以让浏览器展示pdf文档。不同浏览器使用的呈现引擎也不一样，目前主流的呈现引擎有<a href=\"https://webkit.org/\">Webkit</a>、<a href=\"https://www.chromium.org/blink\">Blink</a>(Webkit的一个分支)、<a href=\"https://developer.mozilla.org/en-US/docs/Mozilla/Gecko\">Gecko</a>、<a href=\"https://en.wikipedia.org/wiki/Trident_layout_engine\">Trident</a>、<a href=\"https://en.wikipedia.org/wiki/EdgeHTML\">EdgeHTML</a>(Trident的一个分支)。主流浏览器使用的呈现引擎如表1所示。</p>\n<div style=\"text-align: center;\">表 1 主流浏览器所使用的呈现引擎</div>\n<table>\n<thead>\n<tr>\n<th align=\"center\">浏览器</th>\n<th align=\"center\">呈现引擎</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">Chrome</td>\n<td align=\"center\">Blink（Chrome 28+）、Webkit（Chrome 27-）</td>\n</tr>\n<tr>\n<td align=\"center\">Safari</td>\n<td align=\"center\">Webkit</td>\n</tr>\n<tr>\n<td align=\"center\">Firefox</td>\n<td align=\"center\">Gecko</td>\n</tr>\n<tr>\n<td align=\"center\">Edge</td>\n<td align=\"center\">EdgeHTML</td>\n</tr>\n<tr>\n<td align=\"center\">IE</td>\n<td align=\"center\">Trident</td>\n</tr>\n</tbody>\n</table>\n<h3>呈现引擎的主流程</h3>\n<p>　　当网络模块下载完用户请求的html文档之后，呈现引擎会按照图2所示的流程来解析和呈现html文档中的内容。</p>\n<div style=\"text-align: center;\">\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/59390444fc54097acc6074013c028e3a/7c8cd/render_engine_main_flow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 12.486187845303867%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABcSAAAXEgFnn9JSAAAAoklEQVQI12NgaNniypDeq8GQ1KbH3LnH0n3NWzHWtW/UGTr3qDNWLFFhmH9TTWb1K0X5lc+B7BsqDHVrVBnatitxrnurabL4vizj6peaDA3rlBjq16oxLLory8CQ3qPHyMCgygDE/JVLdfxnXQmXWvZYAciXZGFgUGKQVeO1W3DHyX7eDT+gGBdQDCQnpLb0kabHrMsxnNPPSwH54kCsCMSsAFeOL9h+85V2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"呈现引擎的主要流程\"\n        title=\"\"\n        src=\"/static/59390444fc54097acc6074013c028e3a/40fad/render_engine_main_flow.png\"\n        srcset=\"/static/59390444fc54097acc6074013c028e3a/707e9/render_engine_main_flow.png 148w,\n/static/59390444fc54097acc6074013c028e3a/649e0/render_engine_main_flow.png 295w,\n/static/59390444fc54097acc6074013c028e3a/40fad/render_engine_main_flow.png 590w,\n/static/59390444fc54097acc6074013c028e3a/b3fef/render_engine_main_flow.png 885w,\n/static/59390444fc54097acc6074013c028e3a/301c0/render_engine_main_flow.png 1180w,\n/static/59390444fc54097acc6074013c028e3a/b5a53/render_engine_main_flow.png 1770w,\n/static/59390444fc54097acc6074013c028e3a/7c8cd/render_engine_main_flow.png 1810w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n</div>\n<div style=\"text-align: center;\">图 2 浏览器呈现引擎的主要流程</div>\n<p>　　图2所示的流程是一个渐进式的流程。为了更好的用户体验，呈现引擎不会等到html文档解析完毕之后再去构建和布局呈现树，而是采用类似流水线式的方式，边解析边呈现。</p>\n<h3>Webkit和Gecko的主要流程对比</h3>\n<p>　　Webkit和Gecko的流程图分别如图3和图4所示：</p>\n<div style=\"text-align: center;\">\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/45d5c6c67be54d534928d87334312999/5cdc3/webkit_main_flow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 500px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 46.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACPElEQVQoz2M4d46R+eoVBuaepVWME9cdYPn//z8jAwMDW2/DnHnz+tf9n9Sy8ICvW5gEUIxhxuaDbDP3XwTJM8w+eJGBZNBdvyGagaGaGV0caBgjTk1nzjDGX7nMkN+7rMxg9sErxbP2nY5gYEhh3nR0Y+DqQ6tq9pzfmqgo78i84OjllCUnriyduf+8FkjfklM3WJafu83UtvEhw9OXbIwv3wowPXouzMhw8ybT4ds3GQ52Lm0PnXvg3JfZ+09tTGxdJnfw/MaLe48v/XPsypaZIAPmHbnSNvfwpftT9t3QJcGT6qwgctul03yLj57z6N18Knb6vsvqILHJy+Ypt8xd7Hrq6jqFqkUHOFdduq+/8sJdw7aNL7ifvuRQfP1B0PTRcxFVhv//GZhev2JgnrS+mOnF///g8Jqx/5L9stM3/q+5dPf/wmNXd9bOXm657+yG/1ce7fu/6/Tm6REdeyyWn7n2f/GJq/97Nu1JfPaC8dS7D5z/Hz/nv4nVnfeABjdtvqNctOSKWcuuV0Lbjq0RPXRxi+22I6ssgQbyONWdZl504prugmOXdatXPOe++4hb7t4TEcNbDyUUGY6cU5148pLs+pmbswPnHbm1etHxS0tjW1bJHr24rn/PyVWHj13dVk5S0nj5mv3/jdscP+ftyA2etuvC0hl7TsyYunGr3cHzGw5uO7Tk7JGrO6NA6o5c3sK6+eAKpt1nNjFE9Z9iWHr6JtPiU9eYqld+ZLj/mJvx8QsRpjuPJBgBhcQb7VIb9WoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"webkit的主要流程\"\n        title=\"\"\n        src=\"/static/45d5c6c67be54d534928d87334312999/5cdc3/webkit_main_flow.png\"\n        srcset=\"/static/45d5c6c67be54d534928d87334312999/770e1/webkit_main_flow.png 148w,\n/static/45d5c6c67be54d534928d87334312999/80002/webkit_main_flow.png 295w,\n/static/45d5c6c67be54d534928d87334312999/5cdc3/webkit_main_flow.png 500w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n</div>\n<div style=\"text-align: center;\">图 3 Webkit的主要流程（图片摘自Tali Garsiel的研究成果）</div><br>\n<div style=\"text-align: center;\">\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8044d900d97479907ad635861768fa5f/adc74/gecko_main_flow.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 500px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 46.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAAB3FWwJGJ//8QAGBABAQADAAAAAAAAAAAAAAAAAAIRITH/2gAIAQEAAQUCbZUnj//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/ASf/xAAYEAACAwAAAAAAAAAAAAAAAAAAICExMv/aAAgBAQAGPwLRBSf/xAAdEAABBAIDAAAAAAAAAAAAAAABABEhMRBBUYGR/9oACAEBAAE/IS708QIQEA6TuSv2M/8A/9oADAMBAAIAAwAAABBzz//EABcRAAMBAAAAAAAAAAAAAAAAAAEQETH/2gAIAQMBAT8QOxf/xAAXEQEBAQEAAAAAAAAAAAAAAAABABFR/9oACAECAQE/EFpI9v/EABwQAQACAQUAAAAAAAAAAAAAAAEAETEQIUFxkf/aAAgBAQABPxBGlFJswQM5AKSDA1+TPDH26f/Z'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"gecko的主要流程\"\n        title=\"\"\n        src=\"/static/8044d900d97479907ad635861768fa5f/adc74/gecko_main_flow.jpg\"\n        srcset=\"/static/8044d900d97479907ad635861768fa5f/e40b4/gecko_main_flow.jpg 148w,\n/static/8044d900d97479907ad635861768fa5f/ead33/gecko_main_flow.jpg 295w,\n/static/8044d900d97479907ad635861768fa5f/adc74/gecko_main_flow.jpg 500w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n</div>\n<div style=\"text-align: center;\">图 4 Gecko的主要流程（图片摘自Tali Garsiel的研究成果）</div>\n<p>　　从图3和图4可以看出，Webkit和Gecko的主要流程除了部分术语不同之外，逻辑基本一致。</p>\n<h2>参考文献</h2>\n<ol>\n<li><a href=\"https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/\">Html5rocks: How Browsers Work: Behind the scenes of modern web browsers</a></li>\n<li><a href=\"https://www.w3.org/TR/html5/syntax.html\">HTML: The HTML syntax</a></li>\n<li><a href=\"https://www.zybuluo.com/yangfch3/note/671516\">浏览器内核、JS 引擎、页面呈现原理及其优化</a></li>\n</ol>","frontmatter":{"title":"现代浏览器的工作原理（一）","date":"April 12, 2018","description":"了解浏览器的工作原理是一名前端开发工程师构的必修课。最近，笔者在工作之余，细心研读了以色列开发人员Tali Garsiel针对现代浏览器工作原理的研究成果以及html5标准文档等相关内容，并将自己的心得体会在博客中以笔记的形式记录下来。这篇博文是整个笔记的第一部分，主要对现代浏览器的组成进行介绍。"}}},"pageContext":{"slug":"/notes/20180412215709/","previous":{"fields":{"slug":"/notes/20180411213829/"},"frontmatter":{"title":"querySelector/querySelectorAll遍历元素的顺序"}},"next":{"fields":{"slug":"/tips/20180422162446/"},"frontmatter":{"title":"解决移动端网页开发“滚动穿透”问题"}}}}